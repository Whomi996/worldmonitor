# 世界监视器 v2

由人工智能驱动的实时全球情报仪表板将新闻、市场、地缘政治数据和基础设施监控聚合到统一的态势感知界面中。

🌐 **[Live Demo: worldmonitor.app](https://worldmonitor.app)** | 💻 **[Tech Variant: tech.worldmonitor.app](https://tech.worldmonitor.app)**

__持有人_0__
__持有人_0__
__持有人_0__
__持有人_0__

__持有人_0__

## 平台变体

World Monitor 从单个代码库运行两个专门的变体，每个变体都针对不同的监控需求进行了优化：

|变体 |网址 |焦点|
|---------|-----|-------|
| **🌍世界监视器** | [worldmonitor.app](https://worldmonitor.app) |地缘政治情报、军事追踪、冲突监控、基础设施安全 |
| **💻 技术监控** | [tech.worldmonitor.app](https://tech.worldmonitor.app) |科技行业情报、人工智能/初创生态系统、云基础设施、科技活动 |

标题中的紧凑**变体切换器**允许在变体之间无缝导航，同时保留您的地图位置和面板配置。

---

## 世界监测（地缘政治）

主要变体侧重于地缘政治情报、军事跟踪和基础设施安全监控。

### 关键功能
- **冲突监控** - 活跃战区、热点地区和危机地区，并提供实时升级跟踪
- **军事情报** - 220 多个军事基地、飞行跟踪、海军舰艇监控、激增检测
- **基础设施安全** - 海底电缆、管道、数据中心、互联网中断
- **经济情报** - FRED 指标、石油分析、政府支出、制裁跟踪
- **自然灾害** - 地震、恶劣天气、NASA EONET 事件（野火、火山、洪水）
- **人工智能支持的分析** - 焦点检测、国家不稳定评分、基础设施级联分析

### 情报面板
|面板|目的|
|-------|---------|
| **人工智能见解** |具有焦点检测功能的 LLM 合成世界简介 |
| **人工智能战略态势** |战区级军事力量聚合与打击能力评估|
| **国家不稳定指数** | 20 个受监控国家的实时稳定性评分 |
| **战略风险概述** |结合所有情报模块的综合风险评分|
| **基础设施级联** |电缆、管道和阻塞点的依赖性分析 |
| **实时情报** | GDELT 支持的主题源（军事、网络、核、制裁）|

### 新闻报道
涵盖地缘政治、国防、能源、智囊团和地区新闻（中东、非洲、拉丁美洲、亚太地区）的 80 多个精选资源。

---

## 技术监控

技术变体 ([tech.worldmonitor.app](https://tech.worldmonitor.app)) 为技术部门监控提供专门的层。

### 技术生态系统层
|层 |描述 |
|-------|-------------|
| **技术总部** |主要科技公司总部（大型科技公司、独角兽、上市公司）|
| **创业中心** |主要初创企业生态系统，包括生态系统层级、融资数据和知名公司 |
| **云区域** |具有区域计数的 AWS、Azure、GCP 数据中心区域 |
| **加速器** | Y Combinator、Techstars、500 Startups 和区域加速器地点 |
| **科技活动** |即将举行的会议和技术活动，带有倒计时器 |

### 技术基础设施层
|层 |描述 |
|-------|-------------|
| **人工智能数据中心** | 111个主要AI计算集群（≥10,000个GPU）|
| **海底电缆** |海底光纤路由对于云连接至关重要|
| **互联网中断** |网络中断影响技术运营|

### 科技新闻类别
- **初创公司和风险投资** - 融资轮次、收购、初创公司新闻
- **网络安全** - 安全漏洞、漏洞、威胁情报
- **云和基础设施** - AWS、Azure、GCP 公告、中断
- **硬件和芯片** - 半导体、人工智能加速器、制造
- **开发人员和开源** - 语言、框架、开源项目
- **技术政策** - 监管、反垄断、数字治理

### 区域技术总部覆盖范围

|地区 |著名公司 |
|--------|------------------|
| **硅谷** |苹果、谷歌、Meta、Nvidia、英特尔、思科、甲骨文、VMware |
| **西雅图** |微软、亚马逊、Tableau、Expedia |
| **纽约** |彭博社、MongoDB、Datadog、Squarespace |
| **伦敦** | Revolut、Deliveroo、Darktrace、Monzo |
| **特拉维夫** | Wix、Check Point、Monday.com、Fiverr |
| **迪拜/中东和北非** | Careem、Noon、Anghami、房产查找器、Kitopi |
| **利雅得** | Tabby、Presight.ai、Ninja、XPANCEO |
| **新加坡** | Grab、Razer、Sea Limited |
| **柏林** | Zalando，送货英雄，N26，Celonis |
| **东京** |索尼、丰田、软银、乐天 |

---

## Features

### 互动全球地图
- **缩放和平移** - 使用鼠标/触控板手势平滑导航
- **区域焦点** - 8 个预设视图用于快速导航（全球、美洲、欧洲、中东和北非、亚洲、拉丁美洲、非洲、大洋洲）
- **图层系统** - 切换按类别组织的 20 多个数据层的可见性
- **时间过滤** - 按时间范围（1小时、6小时、24小时、48小时、7天）过滤事件
- **可固定地图** - 在滚动面板时将地图固定到顶部，或让它随页面滚动
- **智能标记聚类** - 低缩放时附近的标记组，放大时展开

### 标记聚类

具有许多数据点的密集区域使用智能聚类来防止视觉混乱：

**它是如何运作的**
- 像素半径内的标记（适应缩放级别）合并到集群徽章中
- 集群徽章显示分组项目的数量
- 单击集群会打开一个弹出窗口，列出所有分组的项目
- 放大缩小簇半径，最终显示单个标记

**分组逻辑**
- **抗议**：仅在同一国家/地区内聚集（骚乱首先排序，严重程度高的优先）
- **科技总部**：同一城市内的集群（大型科技公司排在独角兽之前，排在上市公司之前）
- **技术活动**：同一地点的集群（按日期排序，最早的在前）

这可以防止像迪拜和利雅得公司这样的问题在全球范围内出现合并，同时仍然在大陆范围内提供清晰的可视化。

### 数据层

层被组织成逻辑组以进行有效监控：

**地缘政治**
|层 |描述 |
|-------|-------------|
| **冲突** |活跃冲突地区的参与方和现状|
| **热点** |基于新闻相关性的情报热点及其活动水平|
| **制裁** |受到经济制裁的国家 |
| **抗议** | ACLED 和 GDELT 现场直播社会骚乱事件 |

**军事与战略**
|层 |描述 |
|-------|-------------|
| **军事基地** |来自 9 个运营商的 220 多个全球军事设施 |
| **核设施** |发电厂、武器实验室、浓缩场所|
| **伽马辐射器** | IAEA 追踪的 1-3 类辐射源 |
| **APT 组** |国家支持的具有地理归属的网络威胁行为者 |
| **太空港** | 12 个主要发射设施（NASA、SpaceX、Roscosmos、CNSA、ESA、ISRO、JAXA）|
| **关键矿物质** |战略矿藏（锂、钴、稀土）及运营商信息 |

**基础设施**
|层 |描述 |
|-------|-------------|
| **海底电缆** |全球55条主要海底电缆线路|
| **管道** |横跨各大洲的 88 条正在运营的石油和天然气管道 |
| **互联网中断** | Cloudflare Radar 造成的网络中断 |
| **人工智能数据中心** | 111个主要AI计算集群（≥10,000个GPU）|

**运输**
|层 |描述 |
|-------|-------------|
| **船舶（AIS）** |通过 AIS 进行实时船舶跟踪，包括阻塞点监控和 61 个战略港口* |
| **延误** |美国联邦航空管理局 (FAA) 机场延误状况和地面停靠点 |

*\*通过 [AISStream.io](https://aisstream.io) 的 AIS 数据使用欧洲/大西洋水域覆盖范围更强的地面接收器。中东、亚洲和公海覆盖范围有限。卫星 AIS 提供商（Spire、Kpler）提供全球覆盖，但需要商业许可证。*

**自然事件**
|层 |描述 |
|-------|-------------|
| **自然** | USGS 地震 (M4.5+) + NASA EONET 事件（风暴、野火、火山、洪水）|
| **天气** |国家气象局恶劣天气警告|

**经济和标签**
|层 |描述 |
|-------|-------------|
| **经济** |包含 FRED 指标、EIA 石油分析和 USASpending.gov 政府合同的选项卡经济面板 |
| **国家** |国家边界标签|
| **水路** |战略水道和咽喉要道|

### 情报面板

除了原始数据源之外，仪表板还提供综合智能面板：

|面板|目的|
|-------|---------|
| **人工智能战略态势** |战区级军事聚合与打击能力分析|
| **战略风险概述** |结合所有情报模块的综合风险评分|
| **国家不稳定指数** | 20 个受监控国家的实时稳定性评分 |
| **基础设施级联** |电缆、管道和阻塞点的依赖性分析 |
| **实时情报** | GDELT 支持的主题源（军事、网络、核、制裁）|
| **英特尔饲料** |精选的国防和安全新闻来源|

这些面板通过应用评分算法、趋势检测和跨源关联，将原始信号转化为可操作的情报。

###新闻聚合

跨类别的多源 RSS 聚合：
- **世界/地缘政治** - BBC、路透社、美联社、卫报、NPR、Politico、外交官
- **中东/中东和北非** - 半岛电视台、BBC ME、Guardian ME、阿拉伯电视台、以色列时报
- **非洲** - BBC Africa、News24、Google 新闻聚合（区域和萨赫勒报道）
- **拉丁美洲** - BBC 拉丁美洲、卫报美洲、Google 新闻聚合
- **亚太地区** - BBC Asia、南华早报、Google 新闻聚合
- **能源与资源** - Google 新闻聚合（石油/天然气、核能、采矿、路透社能源）
- **技术** - 黑客新闻、Ars Technica、The Verge、麻省理工学院技术评论
- **人工智能/机器学习** - ArXiv、VentureBeat AI、The Verge AI、麻省理工学院技术评论
- **财经** - CNBC、MarketWatch、金融时报、雅虎财经
- **政府** - 白宫、国务院、五角大楼、财政部、美联储、美国证券交易委员会、联合国新闻、CISA
- **英特尔信息流** - 防御一号、突破防御、Bellingcat、Krebs Security、Janes
- **智库** - 外交政策、大西洋理事会、外交事务、战略与国际研究中心、兰德、布鲁金斯学会、卡内基
- **危机观察** - 国际危机组织、国际原子能机构、世界卫生组织、联合国难民署
- **地区来源** - 新华社、塔斯社、基辅独立报、莫斯科时报
- **裁员追踪** - 科技行业裁员

### 源过滤

标题中的 **📡 SOURCES** 按钮可打开全局源管理模式，从而可以对仪表板中显示的新闻源进行细粒度控制。

**能力：**
- **搜索**：按名称过滤货源列表，快速找到特定网点
- **单独切换**：单击任何源以启用/禁用它
- **批量操作**：“全选”和“全选”以进行快速调整
- **计数器显示**：显示“45/77启用”以指示当前选择
- **持久性**：设置保存到 localStorage 并在会话之间保留

**使用案例：**
- **降噪**：禁用大容量聚合器（Google 新闻）以专注于主要来源
- **区域焦点**：仅启用与特定地理区域相关的来源
- **信号源质量**：禁用信噪比较差的信号源
- **偏见管理**：通过启用/禁用具有已知编辑观点的来源来平衡覆盖范围

**技术细节：**
- 禁用的源在获取时（而不是显示时）进行过滤，减少带宽和 API 调用
- 同时影响所有新闻面板 - 禁用 BBC 一次，它就消失了
- 禁用所有源的面板显示“所有源已禁用”消息
- 更改在下一个刷新周期生效

### 区域情报小组

专门小组针对具有重要战略意义的地区提供重点报道：

|面板|覆盖范围|关键主题|
|-------|----------|------------|
| **中东** |中东和北非地区 |以色列-加沙、伊朗、海湾国家、红海 |
| **非洲** |撒哈拉以南非洲|萨赫勒不稳定、政变、叛乱、资源|
| **拉丁美洲** |中美洲和南美洲 |委内瑞拉、贩毒、地区政治 |
| **亚太地区** |东亚及东南亚 |中国-台湾、朝鲜半岛、东盟|
| **能源与资源** |全球|石油市场、核能、采矿、能源安全|

每个面板汇总特定区域的来源，为该战区提供集中的态势感知。当全球事件需要关注特定地区时，这可以实现集中监控。

### 实时新闻流

通过频道切换嵌入来自主要新闻网络的 YouTube 直播：

|频道|覆盖范围|
|---------|----------|
| **彭博社** |商业及财经新闻 |
| **天空新闻** |英国及国际新闻 |
| **欧洲新闻** |欧洲视角|
| **德国之声新闻** |德国国际广播公司 |
| **法国 24** |法国全球新闻 |
| **阿拉伯电视台** |中东新闻（阿拉伯语视角）|
| **半岛电视台** |中东及国际新闻 |

**核心特点：**
- **频道切换器** - 一键切换网络
- **实时指示器** - 闪烁点显示流状态，单击可暂停/播放
- **静音切换** - 音频控制（默认静音）
- **双宽面板** - 更大的视频播放器，观看效果更好

**性能优化：**

直播面板使用 **YouTube IFrame Player API** 而不是原始 iframe 嵌入。这提供了几个优点：

|特色 |效益 |
|---------|---------|
| **坚持不懈的玩家** |静音/播放/频道更改时不会重新加载 iframe |
| **API控制** |直接 `playVideo()`、`pauseVideo()`、`mute()` 调用 |
| **减少带宽** |相同的流在状态变化时继续
| **更快的切换** |通过 `loadVideoById()` 更改频道 |

**空闲检测：**

为了节省资源，面板实现自动空闲暂停：

|触发|行动|
|---------|--------|
| **选项卡隐藏** |流暂停（通过 Visibility API）|
| **闲置 5 分钟** |流暂停（无鼠标/键盘活动）|
| **用户退货** |流自动恢复 |
| **手动暂停** |单独跟踪用户意图 |

这可以防止后台选项卡消耗带宽，同时保留用户对手动暂停流的偏好。

### 市场数据
- **股票** - 主要指数和科技股通过Finnhub（雅虎财经备份）
- **商品** - 石油、黄金、天然气、铜、VIX
- **加密货币** - 比特币、以太坊、Solana 通过 CoinGecko
- **行业热图** - 视觉行业表现（11 个 SPDR 行业）
- **经济指标** - 通过 FRED 获得的美联储数据（资产、利率、收益率）
- **石油分析** - EIA 数据：WTI/布伦特原油价格、美国产量、美国库存（每周变化）
- **政府支出** - USASpending.gov：最近的联邦合同和奖项

### 预测市场
- 用于事件概率跟踪的综合市场整合
- 与新闻事件的相关性分析

### 搜索 (⌘K)
跨所有数据源的通用搜索：
- 新闻文章
- 地理热点和冲突
- 基础设施（管道、电缆、数据中心）
- 核设施和辐照器
- 市场和预测

### 数据导出
- 当前仪表板状态的 CSV 和 JSON 导出
- 快照历史回放

---

## 信号情报

仪表板不断分析数据流以检测重要模式和异常情况。信号出现在标题徽章 (⚡) 中并带有置信度分数。

### 情报调查结果徽章

标题显示 **情报发现** 徽章，其中合并了两种类型的警报：

|警报类型 |来源 |示例 |
|------------|--------|----------|
| **相关信号** |跨源模式检测 |速度飙升、市场分歧、预测领先 |
| **统一警报** |模块生成的警报 | CII 峰值、地理融合、基础设施级联 |

**交互**：单击徽章 - 或单击单个警报 - 打开一个详细模式，显示：
- 完整的警报描述和上下文
- 组件故障（针对复合警报）
- 受影响国家或地区
- 置信度分数和优先级
- 时间戳和趋势方向

这为所有情报发现提供了一个统一的指挥中心，无论是通过相关性分析还是特定于模块的阈值检测生成的。

### 信号类型

该系统可检测新闻、市场、军事和基础设施领域的 12 种不同信号类型：

**新闻和来源信号**

|信号|触发|这意味着什么？
|--------|---------|---------------|
| **◉ 融合** | 30 分钟内超过 3 种来源类型报告了相同的故事 |多个独立渠道确认同一事件——重要性更高的可能性 |
| **△三角测量** | Wire + 政府 + 英特尔消息来源一致 | “权威三角”——官方渠道、通讯社和国防专家都报道同样的事情 |
| **🔥 速度峰值** |主题提及率翻倍，每小时有 6 个以上来源 |新闻生态系统中的故事正在迅速加速|

**市场信号**

|信号|触发|这意味着什么？
|--------|---------|---------------|
| **🔮 预测领先** |新闻报道较少，预测市场上涨 5% 以上 |市场定价信息尚未反映在新闻中|
| **📰 新闻引领市场** |高新闻传播速度却没有相应的市场走势|尚未定价的突发新闻——潜在的错误定价|
| **✓ 市场走势解释** |相关新闻报道导致市场波动 2% 以上 |价格走势具有可识别的新闻催化剂——实体相关性发现相关故事|
| **📊 沉默的分歧** |实体搜索后市场波动 2%+ 无相关新闻 |详尽搜索后无法解释的价格走势——可能是内幕知识或算法驱动 |
| **📈 扇区级联** |多个相关行业齐头并进|相关行业的市场反应级联|

**基础设施和能源信号**

|信号|触发|这意味着什么？
|--------|---------|---------------|
| **🛢 流量下降** |检测到管道流量中断关键字 |实物大宗商品供应受限——可能先于价格飙升|
| **🔁 流量价​​格背离** |管道中断的消息没有相应的油价波动|能源供应中断尚未反映在潜在信息优势中

**地缘政治和军事信号**

|信号|触发|这意味着什么？
|--------|---------|---------------|
| **🌍地理融合** |同一 1°×1° 网格单元中的 3+ 事件类型 |多个独立数据流汇聚到同一位置——区域活动加剧 |
| **🔺 热点升级** |多项得分突破阈值呈上升趋势 |热点显示新闻、CII、融合和军事数据确实升级|
| **✈ 军事增兵** |战区运输/战斗机活动 2× 基线 |不寻常的军事空运集中——潜在部署或危机应对|

### 它是如何运作的

关联引擎维护以下内容的滚动快照：
- 新闻主题频率（通过关键词提取）
- 市场价格变化
- 预测市场概率

每个刷新周期都会将当前状态与之前的快照进行比较，应用阈值和重复数据删除以避免警报疲劳。信号包括基于模式强度的置信度分数 (60-95%)。

### 实体感知关联

信号引擎使用 **100 多个实体的知识库**来智能地将市场走势与新闻报道关联起来。该系统不是简单的关键字匹配，而是理解“AVGO”（股票代码）与“Broadcom”（公司）、“AI 芯片”（行业）以及“Nvidia”（竞争对手）等实体相关。

#### 实体知识库

注册表中的每个实体包含：

|领域|目的|示例|
|-------|---------|---------|
| **ID** |规范标识符| `broadcom` |
| **姓名** |显示名称 | `Broadcom Inc.` |
| **类型** |类别 | `company`、`commodity`、`crypto`、`country`、`person` |
| **别名** |别名 | `AVGO`、`Broadcom`、`Broadcom Inc` |
| **关键词** |相关主题 | `AI chips`、`semiconductors`、`VMware` |
| **部门** |行业分类 | `semiconductors` |
| **相关** |链接实体 | `nvidia`、`intel`、`amd` |

#### 实体类型

|类型 |计数|示例 |
|------|-------|----------|
| **公司** | 50+ |英伟达、苹果、特斯拉、博通、波音、洛克希德·马丁、台积电、莱茵金属 |
| **指数** | 5+ |标准普尔 500 指数、道琼斯指数、纳斯达克指数 |
| **行业** | 10+ |技术 (XLK)、金融 (XLF)、能源 (XLE)、医疗保健 (XLV)、半导体 (SMH) |
| **商品** | 10+ |石油 (WTI)、黄金、天然气、铜、银、VIX |
| **加密货币** | 3 |比特币、以太坊、Solana |
| **国家** | 15+ |中国、俄罗斯、伊朗、以色列、乌克兰、台湾、沙特阿拉伯、阿联酋、卡塔尔、土耳其、埃及 |

#### 实体匹配的工作原理

当市场大幅波动（≥2%）时，系统：

1. **在实体注册表中查找代码**（例如，`AVGO` → `broadcom`）
2. **收集所有标识符**：别名、关键字、部门同行、相关实体
3. **扫描所有新闻集群**以查找与任何标识符的匹配项
4. **根据匹配类型评分置信度**：
- 别名匹配（确切名称）：95%
- 关键词匹配（主题）：70%
- 相关实体匹配：60%

如果找到相关新闻 → **“市场走势解释”** 带有新闻标题的信号。
如果详尽搜索后没有相关性→**“无声分歧”**信号。

#### 示例：博通 +2.5%

```
1. Ticker AVGO detected with +2.5% move
2. Entity lookup: broadcom
3. Search terms: ["Broadcom", "AVGO", "AI chips", "semiconductors", "VMware", "nvidia", "intel", "amd"]
4. News scan finds: "Broadcom AI Revenue Beats Estimates"
5. Result: "✓ Market Move Explained: Broadcom AI Revenue Beats Estimates"
```

如果没有这个系统，同样的举动将产生通用的“无声分歧：AVGO +2.5%”信号。

#### 行业覆盖范围

实体注册机构涵盖具有重要战略意义的部门：

|部门|示例 |关键词跟踪 |
|--------|----------|------------------|
| **技术** |苹果、微软、英伟达、谷歌、Meta、台积电 |人工智能、云、芯片、数据中心、流媒体 |
| **国防与航空航天** |洛克希德·马丁公司、雷神公司、诺斯罗普·格鲁门公司、波音公司、莱茵金属公司、空客公司 | F-35、导弹、无人机、坦克、国防合同|
| **半导体** | ASML、三星、AMD、英特尔、博通 |光刻、EUV、代工​​、晶圆厂、晶圆 |
| **关键矿物质** | Albemarle、SQM、MP Materials、自由港麦克莫兰 |锂、稀土、钴、铜|
| **金融** |摩根大通、伯克希尔哈撒韦、Visa、万事达卡 |银行、信贷、投资、利率|
| **医疗保健** |礼来 (Eli Lilly)、诺和诺德 (Novo Nordisk)、联合健康 (UnitedHealth)、强生 (J&J) |制药、药物、GLP-1、肥胖、糖尿病 |
| **能源** |埃克森美孚、雪佛龙、康菲石油公司 |石油、天然气、钻井、炼油厂、液化天然气 |
| **消费者** |特斯拉、沃尔玛、好市多、家得宝 |电动汽车、零售、食品杂货、住房 |

这种广泛的覆盖范围使得能够跨不同的地缘政治和市场事件进行相关性检测。

### 实体注册表架构

实体注册表是包含 600 多个实体的知识库，具有用于智能关联的丰富元数据：

```typescript
{
  id: 'NVDA',           // Unique identifier
  name: 'Nvidia',       // Display name
  type: 'company',      // company | country | index | commodity | currency
  sector: 'semiconductors',
  searchTerms: ['Nvidia', 'NVDA', 'Jensen Huang', 'H100', 'CUDA'],
  aliases: ['nvidia', 'nvda'],
  competitors: ['AMD', 'INTC'],
  related: ['AVGO', 'TSM', 'ASML'],  // Related entities
  country: 'US',        // Headquarters/origin
}
```

**实体类型**：

|类型 |计数|使用案例|
|------|-------|----------|
| `company` | 100+ |市场新闻相关性、行业分析 |
| `country` | 200+ |焦点检测、CII 评分 |
| `index` | 20+ |市场概览、区域追踪 |
| `commodity` | 15+ |能源和矿产相关性 |
| `currency` | 10+ |外汇市场追踪|

**查找索引**：

注册表提供了多个查找路径以实现快速实体解析：

|索引 |查询示例|使用案例|
|-------|---------------|----------|
| `byId` | `'NVDA'` → Nvidia 实体 |从股票代码直接查找 |
| `byAlias` | `'nvidia'` → Nvidia 实体 |不区分大小写的名称匹配 |
| `byKeyword` | `'AI chips'` → [Nvidia、AMD、英特尔] |新闻关键词提取 |
| `bySector` | `'semiconductors'` → 所有芯片公司|行业级联分析|
| `byCountry` | `'US'` → 所有美国实体 |国家级汇总|

### 信号重复数据删除

为了防止警报疲劳，信号使用 **特定于类型的 TTL（生存时间）** 值进行重复数据删除：

|信号类型| TTL |理由|
|-------------|-----|-----------|
| **沉默的分歧** | 6 小时 |市场走势持续；请勿对同一股票再次发出警报 |
| **流量价格背离** | 6 小时 |能源事件缓慢展开 |
| **解释市场走势** | 6 小时 |相同的相关性不应重复 |
| **预测领先** | 2小时|预测市场更新更频繁 |
| **其他信号** | 30 分钟 |快速移动事件的默认设置 |

市场信号使用**仅符号键**（例如 `silent_divergence:AVGO`），而不包括价格变化。这意味着股票移动+2.5%然后+3.0%不会触发重复的警报——第一个警报涵盖了整个故事。

---

## 来源情报

并非所有来源都是平等的。系统实行双重分类，优先权威信息。

### 来源层级（权威排名）

|等级 |来源 |特点 |
|------|---------|-----------------|
| **1 级** |路透社、美联社、法新社、彭博社、白宫、五角大楼 |有线服务和官方政府——最快、最可靠 |
| **2 级** | BBC、卫报、NPR、半岛电视台、CNBC、金融时报 |主要媒体——编辑标准高，但有一定延迟 |
| **第 3 级** | 《国防一号》、《Bellingcat》、《外交政策》、《麻省理工科技评论》|领域专家——深厚的专业知识，更窄的范围|
| **4 级** |黑客新闻、The Verge、VentureBeat、聚合器 |有用的信号，但需要证实|

当多个来源报告同一故事时，**最低层**（最权威）来源将显示为主要来源，其他来源则列为佐证。

### 来源类型（分类）

源还按三角测量检测的功能进行分类：

- **Wire** - 新闻机构（路透社、美联社、法新社、彭博社）
- **政府** - 官方政府（白宫、五角大楼、国务院、美联储、证券交易委员会）
- **英特尔** - 国防/安全专家（Defense One、Bellingcat、Krebs）
- **主流** - 主要新闻媒体（BBC、卫报、NPR、半岛电视台）
- **市场** - 财经媒体（CNBC、MarketWatch、金融时报）
- **科技** - 技术报道（黑客新闻、Ars Technica、麻省理工学院技术评论）

### 宣传风险指标

仪表板直观地标记了具有已知国家关系或宣传风险的消息来源，使用户能够适当权衡来自这些渠道的信息。

**风险级别**

|水平|视觉 |意义|
|-------|--------|---------|
| **高** | ⚠ 国家媒体（红色）|国家直接控制或所有权|
| **中** | ！注意（橙色）|重大的国家影响或资助|
| **低** | （无）|独立编辑控制|

**标记来源**

|来源 |风险等级|国家隶属关系 |笔记|
|--------|------------|-------------------|-------|
| **新华社** |高|中国（中共）|中华人民共和国官方通讯社 |
| **塔斯社** |高|俄罗斯 |国有通讯社|
| **转发** |高|俄罗斯 |美国注册外国代理人|
| **中国国际电视台** |高|中国（中共）|中国环球电视网|
| **新闻电视** |高|伊朗 | IRIB 子公司 |
| **半岛电视台** |中等|卡塔尔 |卡塔尔政府资助|
| **TRT世界** |中等|土耳其 |土耳其国家广播公司 |

**展示地点**

宣传风险徽章出现在：
- **集群主要源**：主源名称旁边的徽章
- **热门来源列表**：每个标记来源旁边的小徽章
- **集群视图**：扩展多源集群时可见

**为什么要包括国家媒体？**

国家控制的网点被纳入而不是被过滤，因为：

1. **信号价值**：官方媒体报道（和省略）的内容揭示了政府的优先事项
2. **快速反应**：官方媒体通常比国际媒体更快地报道国内新闻
3. **叙事分析**：了解不同政府如何塑造事件
4. **完整性**：排除它们会造成覆盖盲点

这些徽章确保用户可以**了解**官方媒体的报道，而不是在不知不觉中将其视为独立新闻。

---

## 实体提取系统

该仪表板从新闻标题中提取**命名实体**（公司、国家、领导者、组织），以实现新闻与市场的关联和基于实体的过滤。

### 它是如何运作的

根据策划的实体索引扫描标题，其中包含：

|实体类型 |示例 |目的|
|-------------|----------|---------|
| **公司** |苹果、特斯拉、英伟达、波音 |市场符号相关性 |
| **国家** |俄罗斯、中国、伊朗、乌克兰 |地缘政治归因|
| **领导者** |普京、习近平、哈梅内伊 |政治事件追踪|
| **组织** |北约、欧佩克、美联储、美国证券交易委员会 |机构新闻过滤|
| **商品** |石油、黄金、比特币 |商品新闻相关|

### 实体匹配

每个实体都有多种匹配模式以进行全面检测：

```
Entity: NVIDIA (NVDA)
  Aliases: nvidia, nvda, jensen huang
  Keywords: gpu, h100, a100, cuda, ai chip
  Match Types:
    - Name match: "NVIDIA announces..." → 95% confidence
    - Alias match: "Jensen Huang says..." → 90% confidence
    - Keyword match: "H100 shortage..." → 70% confidence
```

### 置信度评分

实体提取根据匹配质量生成置信度分数：

|比赛类型 |信心|示例|
|------------|------------|---------|
| **直名** | 95% | “苹果公布财报” |
| **别名** | 90% | “蒂姆·库克宣布……” |
| **关键字** | 70% | “iPhone销量下滑”|
| **相关集群** | 63% |次要标题提及 (90% × 0.7) |

### 市场相关性

当市场符号大幅波动时，系统会在新闻集群中搜索相关实体：

1. **符号查找** - 按市场符号查找实体（例如 `AAPL` → Apple）
2. **新闻搜索** - 查找提及实体或相关实体的集群
3. **置信度排名** - 按提取置信度排序
4. **结果** - “市场走势得到解释”或“无声背离”信号

这可以实现如下信号：
- **解释**：“AVGO +5.2% — 3 个新闻集群中提到博通（AI 芯片需求）”
- **沉默**：“AVGO +5.2% — 实体搜索后没有相关新闻”

---

## 信号上下文（“为什么重要”）

每个信号都包含解释其分析意义的上下文信息：

### 上下文字段

|领域|目的|示例|
|-------|---------|---------|
| **为什么重要** |分析意义| “市场先于新闻定价”|
| **可行的见解** |下一步做什么 | “1-6小时监控突发新闻”|
| **信心说明** |信号可靠性警告| “如果多个市场一致，信心就会更高”|

### 信号特定上下文

|信号|为什么这很重要？
|--------|---------------|
| **预测领先** |预测市场通常会在信息成为新闻之前对其进行定价——交易者可以尽早了解事态发展|
| **沉默的分歧** |市场走势没有可识别的催化剂——可能是内幕知识、算法交易或未报告的发展 |
| **速度峰值** |多个来源的报道加速——表明市场/政策影响的重要性和潜力日益增长|
| **三角测量** | “权威三角”（电报+政府+情报）一致——突发新闻确认的黄金标准 |
| **流量价格背离** |供应中断尚未反映在价格中——潜在的信息优势或市场拥有更好的信息|
| **热点升级** |地缘政治热点在新闻、不稳定、融合和军事存在方面呈现升级|

该上下文层通过解释每个信号背后的分析推理，将原始警报转化为**可操作的情报**。

---

## 算法与设计

### 新闻聚类

相关文章使用标记化标题上的 **Jaccard 相似度** 进行分组：

```
similarity(A, B) = |A ∩ B| / |A ∪ B|
```

**标记化**：
- 标题为小写并在字边界处分割
- 删除停用词：“the”、“a”、“an”、“in”、“on”、“at”、“to”、“for”、“of”、“and”、“or”
- 过滤掉短标记（<3 个字符）
- 每个标题缓存结果以提高性能

**倒排索引优化**：
该算法使用倒排索引，而不是 O(n²) 成对比较：

1. 构建代币→文章索引图
2. 对于每篇文章，通过共享令牌查找候选匹配项
3. 只计算具有 token 重叠的候选者的 Jaccard
4. 这将典型新闻负载的比较从约 10,000 次减少到约 500 次

**聚类规则**：
- 相似度≥0.5的文章被分组为簇
- 集群按源层排序，然后按新近度排序
- 最权威的来源成为“主要”标题
- 集群维护多源归因的完整项目列表

### 速度分析

每个新闻集群跟踪发布速度：

- **每小时来源** = 文章数/时间跨度
- **趋势** = 基于上半年与下半年发表率的上升/稳定/下降
- **级别**：正常（<3/hr), Elevated (3-6/hr), Spike (>6/小时）

### 情绪检测

标题是根据精选的单词列表进行评分的：

**负面指标**：战争、袭击、死亡、危机、坠机、崩溃、威胁、制裁、入侵、导弹、恐怖、暗杀、经济衰退、裁员……

**积极指标**：和平、协议、协议、突破、复苏、增长​​、停火、条约、联盟、胜利......

分数决定情感分类：负 (<-1), neutral (-1 to +1), positive (>+1)

### 实体提取

使用**字边界正则表达式匹配**根据实体知识库扫描新闻标题：

```
regex = /\b{escaped_alias}\b/gi
```

**指数结构**：
实体索引预先构建了五个查找映射以进行 O(1) 访问：

|地图 |关键|价值|目的|
|-----|-----|-------|---------|
| `byId` |实体 ID |完整的实体记录 |直接查找|
| `byAlias` |小写别名 |实体 ID |姓名匹配|
| `byKeyword` |小写关键字 |实体 ID 集 |主题匹配 |
| `bySector` |部门名称 |实体 ID 集 |部门查询 |
| `byType` |实体类型 |实体 ID 集 |类型过滤|

**匹配算法**：

1. **别名匹配**（最高置信度）：
- 迭代所有别名（至少 3 个字符以避免误报）
- 字边界正则表达式防止部分匹配（“AI”不会匹配“RAID”）
- 每个实体的第一个别名匹配停止进一步搜索（重复数据删除）

2. **关键词匹配**（中等置信度）：
- 简单的子字符串检查（比正则表达式更快）
- 多个实体可能匹配相同的关键字
- 置信度 (70%) 低于别名匹配 (95%)

3. **相关实体扩展**：
- 如果实体具有 `related` 字段，则还会检查这些实体
- 示例：AVGO move 还搜索 NVDA、INTC、AMD 新闻

**表现**：
- 索引在第一次访问时构建一次（缓存单例）
- Alias 地图包含 100 多个实体的约 300 个条目
- 关键字图有约 400 个条目
- 完整新闻扫描：O(别名 × 簇) ≈ 300 × 50 = 15,000 次比较

### 基线偏差（Z 分数）

系统维护每个主题的新闻量滚动基线：

- **7 天平均值** 和 **30 天平均值** 存储在 IndexedDB 中
- 根据历史计数计算的标准偏差
- **Z 分数** =（当前 - 平均值）/ stddev

偏差水平：
- **尖峰**：Z > 2.5（统计上罕见的增加）
- **升高**：Z > 1.5
- **正常**：-2 < Z < 1.5
- **安静**：Z < -2（活动异常低）

即使绝对数量看起来正常，这也能够检测到异常活动。

---

## 动态热点活动

地图上的热点**不是静态威胁级别**。活动是根据新闻相关性实时计算的。

每个热点定义关键字：
```typescript
{
  id: 'dc',
  name: 'DC',
  keywords: ['pentagon', 'white house', 'congress', 'cia', 'nsa', ...],
  agencies: ['Pentagon', 'CIA', 'NSA', 'State Dept'],
}
```

系统对当前提要中匹配的新闻文章进行计数，应用速度分析并分配活动级别：

|水平|标准|视觉 |
|-------|----------|--------|
| **低** | <3 场比赛，正常速度 |灰色记号笔|
| **提升** | 3-6 场比赛或提高速度 |黄脉|
| **高** | >6 场比赛或尖峰速度 |红色脉冲|

这创建了基于实时新闻流的全球关注的动态“热图”。

### 热点升级信号

除了视觉活动水平之外，当热点在多个维度上显示出显着变化时，系统还会生成**升级信号**。这种多组件方法通过需要独立数据流的证实来减少误报。

**升级组件**

每个热点的升级分数混合了四个加权成分：

|组件|重量 |数据来源|它测量什么 |
|-----------|--------|-------------|------------------|
| **新闻活动** | 35% | RSS 提要 |匹配新闻数、打破旗帜、速度 |
| **CII 贡献** | 25% |国家不稳定指数|相关国家的不稳定得分 |
| **地理融合** | 25% |多源事件 |地理单元中的事件类型多样性|
| **军事活动** | 15% |开放天空/AIS | 200公里范围内的航班和船只 |

**分数计算**

```
static_baseline = hotspot.baselineRisk  // 1-5 per hotspot
dynamic_score = (
  news_component × 0.35 +
  cii_component × 0.25 +
  geo_component × 0.25 +
  military_component × 0.15
)
proximity_boost = hotspot_proximity_multiplier  // 1.0-2.0

final_score = (static_baseline × 0.30 + dynamic_score × 0.70) × proximity_boost
```

**趋势检测**

系统为每个热点维护 48 点历史记录（24 小时，每 30 分钟一次）：
- **线性回归**计算最近分数的斜率
- **上升**：斜率 > +0.1 点/间隔
- **下降**：斜率 < -0.1 点/间隔
- **稳定**：斜率在±0.1以内

**信号生成**

在以下情况下会发出升级信号 (`hotspot_escalation`)：
1. 最终分数超过阈值（通常为 60）
2. 自该热点上次发出信号以来至少 2 小时（冷却时间）
3. 趋势上升或分数很关键（>80）

**信号上下文**

|领域|内容 |
|-------|---------|
| **为什么重要** | “由于新闻活动、国家不稳定、地理融合和军事存在，地缘政治热点显着升级”|
| **可行的见解** | “提高监测优先级；评估下游对基础设施、市场和区域稳定的影响” |
| **信心说明** | “按多个数据源加权——新闻 (35%)、CII (25%)、地理融合 (25%)、军事 (15%)” |

这种多信号方法意味着热点升级信号代表独立数据流中的**确凿证据**，而不仅仅是新闻提及的激增。

---

## 区域重点导航

标题中的焦点选择器提供对战略区域的即时导航。每个预设都经过校准，以具有适当缩放级别的区域地理区域为中心。

### 可用区域

|地区 |覆盖范围|主要用例 |
|--------|----------|-------------------|
| **全球** |完整的世界观 |概览、跨区域比较 |
| **美洲** |北美聚焦|美国监测、北美防空司令部活动 |
| **欧洲** |欧盟+英国+斯堪的纳维亚半岛+俄罗斯西部|北约活动、能源基础设施|
| **中东和北非** |中东+北非|冲突地区、石油基础设施|
| **亚洲** |东亚+东南亚|中国-台湾、朝鲜半岛|
| **拉丁美洲** |中美洲+南美洲|地区不稳定、贩毒|
| **非洲** |撒哈拉以南非洲|冲突地区、资源开采|
| **大洋洲** |澳大利亚+太平洋|印度-太平洋活动|

### 快速导航

FOCUS 下拉菜单可实现快速上下文切换：

1. **突发新闻** - 跳转至受影响地区
2. **区域简报** - 循环浏览各区域以了解情况
3. **危机监控** - 锁定特定战区

区域视图被编码在可共享的 URL 中，从而可以直接链接到特定的地理环境。

---

## 地图固定

默认情况下，地图随页面滚动，允许您向下滚动以查看下面的面板。地图标题中的 **固定按钮** (📌) 可切换粘性行为：

|状态|行为 |
|-------|----------|
| **取消固定**（默认）|地图随页面滚动；向下滚动查看面板 |
| **固定** |地图固定在顶部；面板在下方滚动 |

### 何时固定

- **主动监控** - 在阅读新闻面板时保持地图可见
- **交叉引用** - 将地图标记与面板数据进行比较
- **演示** - 在讨论面板内容时显示地图

### 何时取消固定

- **面板焦点** - 通读面板，无需地图占用屏幕空间
- **移动设备** - 在移动设备上禁用 Pin 图以提高空间利用率
- **研究** - 专注于数据面板，不受地理干扰

Pin 状态通过 localStorage 在会话之间保持不变。

---

## 国家不稳定指数 (CII)

该仪表板维护 20 个具有重要战略意义的国家的**实时不稳定评分**。 CII 不依赖静态风险评级，而是根据多个输入流动态反映当前状况。

### 受监控国家/地区（第 1 级）

|地区 |国家 |
|--------|-----------|
| **美洲** |美国、委内瑞拉 |
| **欧洲** |德国、法国、英国、波兰 |
| **东欧** |俄罗斯、乌克兰 |
| **中东** |伊朗、以色列、沙特阿拉伯、土耳其、叙利亚、也门 |
| **亚太地区** |中国、台湾、朝鲜、印度、巴基斯坦、缅甸 |

### 三部分分数

每个国家的 CII 由三个加权部分计算得出：

|组件|重量 |数据来源|它测量什么 |
|-----------|--------|--------------|------------------|
| **骚乱** | 40% | ACLED 抗议、GDELT 活动 |内乱强度、死亡人数、事件严重程度 |
| **安全** | 30% |军用飞行、海军舰艇|不寻常的军事活动模式|
| **信息** | 30% |新闻速度、警报集群 |媒体关注强度和加速度|

### 评分算法

```
Unrest Score:
  base = min(50, protest_count × 8)
  fatality_boost = min(30, total_fatalities × 5)
  severity_boost = min(20, high_severity_count × 10)
  unrest = min(100, base + fatality_boost + severity_boost)

Security Score:
  flight_score = min(50, military_flights × 3)
  vessel_score = min(30, naval_vessels × 5)
  security = min(100, flight_score + vessel_score)

Information Score:
  base = min(40, news_count × 5)
  velocity_boost = min(40, avg_velocity × 10)
  alert_boost = 20 if any_alert else 0
  information = min(100, base + velocity_boost + alert_boost)

Final CII = round(unrest × 0.4 + security × 0.3 + information × 0.3)
```

### 预防评分偏差

原始新闻量会产生一种自然的偏见——英语媒体对美国、英国和西欧的报道远多于对冲突地区的报道。如果不进行修正，稳定的民主国家的得分将始终高于实际的危机地区。

**高容量国家/地区的对数缩放**

媒体报道率高的国家的动荡和信息分数受到对数抑制：

```
if (newsVolume > threshold):
  dampingFactor = 1 / (1 + log10(newsVolume / threshold))
  score = rawScore × dampingFactor
```

这确保了美国收到 50 条关于日常政治活动的新闻提及，不会超过乌克兰 10 条关于活跃战斗的提及。

**冲突区楼层分数**

活跃冲突区域具有最低分数下限，可防止它们在数据缺口或低覆盖率期间显得稳定：

|国家 |楼层|理由|
|---------|-------|-----------|
|乌克兰 | 55 | 55与俄罗斯的积极战争|
|叙利亚 | 50 | 50持续的内战|
|也门 | 50 | 50持续的内战|
|缅甸 | 45 | 45军事政变、内战|
|以色列 | 45 | 45加沙冲突活跃 |

标准计算*之后*应用下限——如果计算出的分数超过下限，则使用计算出的分数。这可以防止错误的“全部清除”信号，同时保持对实际升级的敏感性。

### 不稳定程度

|水平|分数范围|视觉 |意义|
|-------|-------------|--------|---------|
| **关键** | 81-100 | 81-100红色|危机活跃或严重升级|
| **高** | 66-80 | 66-80橙色|需要密切监测的显着不稳定|
| **提升** | 51-65 | 51-65黄色|高于正常的活动模式|
| **正常** | 31-50 | 31-50灰色|地缘政治活动基线|
| **低** | 0-30 |绿色|异常安静的时期 |

### 趋势检测

CII 跟踪 24 小时变化以确定轨迹：
- **上升**：分数增加≥5分（情况不断升级）
- **稳定**：变化在±5点以内（稳定状态）
- **下降**：分数下降 ≥5 分（降级）

### 上下文分数提升

除了基本成分分数外，几个背景因素可以提高一个国家/地区的 CII 分数（总计最多 23 分）：

|升压类型|最大积分 |状况 |目的|
|------------|------------|-----------|---------|
| **热点活动** | 10 | 10指定热点附近的事件 |捕获局部升级|
| **新闻紧迫性** | 5 |信息分量≥50|高媒体关注度指标|
| **焦点** | 8 | AI 国家焦点检测 |多源融合指标|

**热点提升计算**：
- 热点活动 (0-100) 按 1.5 倍缩放，然后上限为 10
- 对没有相关热点活动的国家进行零提升

**新闻紧急度提升等级**：
- 信息≥70：+5分
- 信息≥50：+3分
- 信息<50：+0分

**焦点提升等级**：
- 紧急程度：+8分
- 紧急程度提高：+4 分
- 正常紧急程度：+0分

这些提升旨在仅在存在确凿证据的情况下提高分数——一个国家必须同时拥有高基础分数和背景信号才能达到极端水平。

### 服务器端预计算

为了消除新用户在学习模式预热期间看到空白数据的“冷启动”问题，CII 分数是通过 `/api/risk-scores` 端点在服务器端**预先计算的。有关详细信息，请参阅 [Server-Side Risk Score API](#server-side-risk-score-api) 部分。

### 学习模式（15 分钟热身）

仪表板启动时，CII 系统进入**学习模式** - 一个 15 分钟的校准期，在此期间计算分数但抑制警报。这可以防止系统建立基线值时出现大量误报警报。

**注意**：服务器端预计算现在为新用户提供即时分数——学习模式主要影响客户端动态调整和警报生成，而不是初始分数显示。

**为什么是 15 分钟？** 实际测试表明，CII 分数在大约 10-20 分钟的数据收集后稳定下来。 15 分钟的窗口期提供了足够的时间：
- 跨所有数据源的多个刷新周期
- 趋势检测以确定方向（上升/稳定/下降）
- 跨源相关性以标准化偏差

**视觉指示器**

在学习模式期间，仪表板提供清晰的视觉反馈：

|地点 |指标|
|----------|-----------|
| **CII 面板** |带有进度条和倒计时器的黄色横幅|
| **战略风险概述** | “学习模式 - Xm 直到可靠”状态 |
| **分数显示** |分数以 60% 不透明度显示（变暗）|

**行为**

```
Minutes 0-15: Learning Mode Active
  - CII scores calculated and displayed (dimmed)
  - Trend detection active (stores baseline)
  - All CII-related alerts suppressed
  - Progress bar fills as time elapses

After 15 minutes: Learning Complete
  - Full opacity scores
  - Alert generation enabled (threshold ≥10 point change)
  - "All data sources active" status shown
```

这可确保用户了解早期分数是临时的，同时防止校准期间出现警报疲劳。

### 关键字归因

国家/地区通过关键字列表与数据进行匹配：
- **俄罗斯**：`russia`、`moscow`、`kremlin`、`putin`
- **中国**：`china`、`beijing`、`xi jinping`、`prc`
- **台湾**：`taiwan`、`taipei`

即使源数据中不存在正式的国家/地区代码，这也可以将新闻和事件归因于特定国家/地区。

---

## 地理融合检测

最有价值的情报信号之一是**多个独立数据流汇聚到同一地理区域**。这通常发生在重大事件之前。

### 它是如何运作的

该系统维护地理单元的实时网格（1°×1°分辨率）。每个单元跟踪四种事件类型：

|事件类型 |来源 |检测方法|
|------------|--------|-----------------|
| **抗议** | ACLED/GDELT |直接地理定位 |
| **军事航班** |开放天空 | ADS-B 位置 |
| **海军舰艇** | AIS 流 |船舶位置|
| **地震** |美国地质勘探局|震中位置|

当 24 小时窗口内同一单元内发生**3 种或更多不同的事件类型**时，会生成**收敛警报**。

### 收敛评分

```
type_score = event_types × 25      # Max 100 (4 types)
count_boost = min(25, total_events × 2)
convergence_score = min(100, type_score + count_boost)
```

### 警报阈值

|类型趋同 |分数范围|警报级别|
|-----------------|-------------|-------------|
| **4 种** | 80-100 |关键|
| **3 种** | 60-80 | 60-80高|
| **3 种**（低计数）| 40-60 | 40-60中等|

### 示例场景

**台湾海峡建设**
- 手机：`25°N, 121°E`
- 活动：军事飞行 (3)、海军舰艇 (2)、抗议 (1)
- 分数：75 + 12 = 87（严重）
- 信号：“地理融合（3种）-军事飞行、海军舰艇、抗议”

**中东闪点**
- 手机：`32°N, 35°E`
- 事件：军事飞行 (5)、抗议 (8)、地震 (1)
- 分数：75 + 25 = 100（严重）
- 信号：多个活动流汇聚到区域

### 为什么这很重要

单个数据点通常是噪音。但是，当**抗议爆发、军事资产重新部署以及地震监测器在同一地点同时检测到异常**时，无论是否有任何单一来源报告危机，都值得关注。

---

## 基础设施级联分析

关键基础设施是相互依存的。电缆切断不仅会影响连通性，还会在相关国家和系统之间产生连锁效应。级联分析系统将这些依赖性可视化。

### 依赖图

系统构建了 **279 个基础设施节点**和 **280 个依赖边**的图：

|节点类型 |计数|示例 |
|-----------|-------|----------|
| **海底电缆** | 18 | 18 MAREA，欧洲-亚洲旗帜，SEA-ME-WE 6 |
| **管道** | 88 | 88北溪，横贯西伯利亚，基斯通 |
| **端口** | 61 | 61新加坡、鹿特丹、深圳 |
| **瓶颈** | 8 |苏伊士运河、霍尔木兹海峡、马六甲 |
| **国家** | 105 | 105代表国家影响力的终端节点 |

### 级联计算

当用户选择基础设施资产进行分析时，**广度优先级联**将通过图表传播：

```
1. Start at source node (e.g., "cable:marea")
2. For each dependent node:
   impact = edge_strength × disruption_level × (1 - redundancy)
3. Categorize impact:
   - Critical: impact > 0.8
   - High: impact > 0.5
   - Medium: impact > 0.2
   - Low: impact ≤ 0.2
4. Recurse to depth 3 (prevent infinite loops)
```

### 冗余建模

系统考虑替代路线：
- 具有高冗余度的电缆显示出较小的影响
- 拥有多个电缆着陆点的国家的脆弱性较低
- 替代路线以容量百分比显示

### 实例分析

**MAREA 电缆中断**：
```
Source: MAREA (US ↔ Spain, 200 Tbps)
Countries Affected: 4
- Spain: Medium (redundancy via other Atlantic cables)
- Portugal: Low (secondary landing)
- France: Low (alternative routes via UK)
- US: Low (high redundancy)
Alternative Routes: TAT-14 (35%), Hibernia (22%), AEConnect (18%)
```

**标记欧洲-亚洲中断**：
```
Source: FLAG Europe-Asia (UK ↔ Japan)
Countries Affected: 7
- India: Medium (major capacity share)
- UAE, Saudi Arabia: Medium (limited alternatives)
- UK, Japan: Low (high redundancy)
Alternative Routes: SEA-ME-WE 6 (11%), 2Africa (8%), Falcon (8%)
```

### 用例

- **预先定位**：了解哪些国家最容易受到特定基础设施故障的影响
- **风险评估**：评估供应链面临的阻塞点中断风险
- **事件响应**：快速识别报告的电缆切断或管道损坏的下游影响

---

## 海底电缆活动监测

仪表板监控实时电缆操作和官方海事预警系统的建议，提供潜在连接中断的早期预警。

### 数据源

|来源 |覆盖范围|数据类型|
|--------|----------|-----------|
| **NGA 警告** |全球| NAVAREA 海上警告 |
| **有线运营商** |特定路线 |维护咨询|

### 它是如何运作的

该系统解析 NGA（国家地理空间情报局）针对电缆相关活动的海上警报：

1. **关键字过滤**：提取包含“CABLE”、“CABLESHIP”、“SUBMARINE CABLE”、“FIBER OPTIC”的警告
2. **坐标解析**：从警告文本中提取DMS和十进制坐标
3. **电缆匹配**：坐标与5°半径内最近的电缆路线匹配
4. **严重程度分类**：“FAULT”、“BREAK”、“DAMAGE”等关键字表示故障；其他表示维护

### 警报类型

|类型 |触发|地图显示|
|------|---------|-------------|
| **有线咨询** |任何与电缆相关的 NAVARE 警告 | ⚠ 位置处有黄色标记 |
| **修理船** |警告中检测到电缆船名称 | 🚢 带有状态的船舶图标 |

### 修理船追踪

当警告中提到电缆船时，系统会提取：
- **船只名称**：CS Reliance、Cable Innovator 等。
- **状态**：“途中”或“在站”
- **位置**：当前工作区域
- **关联电缆**：最近的电缆路线

这样可以在运营商正式发布公告之前监控正在进行的维修操作。

### 为什么这很重要

海底电缆承载着 95% 的洲际数据流量。电缆切断可以：
- 导致区域互联网中断
- 扰乱金融交易
- 影响军事通信
- 创造经济连锁效应

尽早了解电缆运行情况（甚至维护时段）可以为应急计划提供提前警告。

---

## 战略风险概述

战略风险概述提供了一个**复合仪表板**，将所有情报模块综合为单个风险评估。

### 综合分数（0-100）

战略风险评分由三个组成部分组成：

|组件|重量 |计算|
|-----------|--------|-------------|
| **收敛** | 40% | `min(100, convergence_zones × 20)` |
| **CII 偏差** | 35% | `min(100, avg_deviation × 2)` |
| **基础设施** | 25% | `min(100, incidents × 25)` |

### 风险级别

|分数 |水平|趋势图标|意义|
|-------|-------|------------|---------|
| 70-100 | **关键** | 📈 不断升级 |多重危机汇聚 |
| 50-69 | 50-69 **提升** | ➡️稳定|全球紧张局势加剧|
| 30-49 | 30-49 **中等** | ➡️稳定|正常波动|
| 0-29 | **低** | 📉 降级 |异常安静的时期 |

### 统一警报系统

使用**时间和空间重复数据删除**合并来自所有模块的警报：

- **时间窗口**：2小时内的警报可能会被合并
- **距离阈值**：200公里内的警报可能会合并
- **同一国家**：影响同一国家/地区的警报可能会合并

当警报合并时，它们将成为显示完整情况的**复合警报**：

```
Type: Composite Alert
Title: Convergence + CII + Infrastructure: Ukraine
Components:
  - Geographic Convergence: 4 event types in Kyiv region
  - CII Spike: Ukraine +15 points (Critical)
  - Infrastructure: Black Sea cables at risk
Priority: Critical
```

### 警报优先级

|优先|标准|
|----------|----------|
| **关键** | CII临界水平，收敛分数≥80，级联临界影响|
| **高** | CII高水平，收敛分数≥60，级联影响≥5个国家 |
| **中** | CII变化≥10分，收敛分≥40 |
| **低** |微小变化和低影响事件 |

### 趋势检测

系统跟踪一段时间内的综合得分：
- 第一次测量建立基线（显示“稳定”）
- 随后±5点的变化触发趋势变化
- 这可以防止初始化时出现错误的“升级”信号

---

## 五角大楼披萨指数 (PizzINT)

该仪表板集成了政府和军事设施附近战略地点的实时人流量数据。这种“披萨指数”概念——追踪五角大楼、兰利和其他设施附近餐馆的深夜活动高峰——提供了危机活动的非传统指标。

### 它是如何运作的

系统聚合来自受监控位置的正常指标百分比：

1. **地点**：五角大楼、中央情报局、国家安全局、国务院和其他设施附近的快餐店、披萨店和便利店
2. **聚合**：对活动百分比进行平均，上限为 100%
3. **尖峰检测**：标记超出基线的位置

### DEFCON 式警报

总体活动映射到 5 级准备程度：

|水平|门槛|标签|意义|
|-------|-----------|-------|---------|
| **DEFCON 1** | ≥90% |待击的手枪 |最大程度的准备；危机应对积极|
| **DEFCON 2** | ≥75% |快节奏|高活性；重大事件正在进行中 |
| **DEFCON 3** | ≥50% |圆屋|升高；高于正常运营 |
| **DEFCON 4** | ≥25% |双摄 |提高警惕|
| **DEFCON 5** | <25% |淡出|平时正常行动|

### GDELT 张力对

该指标还显示 GDELT（全球事件、语言和语气数据库）的地缘政治紧张局势得分：

|配对|监控关系 |
|------|----------------------|
|美国 ↔ 俄罗斯 |主要核对手 |
|美国 ↔ 中国 |经济与军事竞争|
|美国 ↔ 伊朗 |中东地区紧张局势|
|以色列 ↔ 伊朗 |潜在的直接冲突|
|中国 ↔ 台湾 |两岸关系 |
|俄罗斯 ↔ 乌克兰 |活跃冲突区 |

每对显示：
- **当前紧张评分**（GDELT 的标准化指标）
- **7天趋势**（上涨、下跌、稳定）
- **与上一时期相比的百分比变化**

这为活动水平提供了背景——中台紧张局势升级期间五角大楼地点的峰值与平静时期相比具有不同的重要性。

---

## 相关资产

新闻集群会通过附近的关键基础设施自动丰富。当故事提到某个地理区域时，系统会识别 600 公里范围内的相关资产，提供即时的操作背景。

### 资产类型

|类型 |来源 |示例 |
|------|--------|----------|
| **管道** | 88条全球航线|北溪，基斯通，跨西伯利亚 |
| **海底电缆** | 55 条主要电缆 | TAT-14, SEA-ME-WE, Pacific Crossing |
| **人工智能数据中心** | 111 个集群（≥10k GPU）| Azure 美国东部，GCP 康瑟尔布拉夫斯 |
| **军事基地** |超过 220 次安装 | Ramstein, 迪戈加西亚岛, 关岛 |
| **核设施** | 100 多个网站 |发电厂、武器实验室、浓缩|

### 位置推断

该系统通过以下方式推断新闻报道的地理焦点：

1. **关键词匹配**：根据热点关键词列表扫描标题（例如“台湾”→台湾海峡热点）
2. **置信度评分**：多个关键词匹配可提高位置置信度
3. **回退到冲突**：如果没有热点匹配，则检查活动冲突区域

### 距离计算

资产按照距推断位置的半正矢距离进行排名：

```
d = 2r × arcsin(√(sin²(Δφ/2) + cos(φ₁) × cos(φ₂) × sin²(Δλ/2)))
```

每种类型最多显示 3 个资产，按邻近程度排序。

### 示例上下文

有关“德国管道爆炸”的新闻集群将显示：
- **管道**：北溪（23公里）、亚马尔-欧洲（156公里）
- **电缆**：TAT-14 着陆（89 公里）
- **基地**：拉姆施泰因（234 公里）

单击资产会将地图缩放到其位置并显示详细信息。

---

## 自定义监视器

创建扫描所有传入新闻的个性化关键字警报：

1. 输入以逗号分隔的关键字（例如“nvidia、gpu、芯片短缺”）
2.系统分配唯一的颜色
3. 匹配的文章在监控面板中突出显示
4. 集群中的匹配文章继承显示器颜色

监视器通过 LocalStorage 跨会话持续存在。

---

## 活动追踪

仪表板突出显示新到达的项目，以便您可以快速识别自上次查看以来发生的变化。

### 视觉指示器

|指标|持续时间 |目的|
|-----------|----------|---------|
| **新标签** | 2 分钟 |刚刚出现的物品上的徽章 |
| **发光高光** | 30 秒 |微妙的动画吸引注意力|
| **面板徽章** |直到查看 |折叠面板中的新项目计数 |

### 自动“看到”检测

系统使用 IntersectionObserver 来检测面板何时可见：

- 当面板可见度 >50% 且持续时间 >500 毫秒时，项目将被标记为“已看到”
- 滚动面板逐步标记可见项目
- 切换面板适当地重置“新”状态

### 面板特定跟踪

每个面板保持独立的活动状态：

- **新闻**：自上次查看以来的新集群
- **市场**：价格变化超过阈值
- **预测**：概率变化 >5%
- **自然事件**：新的地震和 EONET 事件

这可以实现集中监控 - 您可以折叠已查看的面板并一目了然地看到有新活动。

---

## 快照系统

仪表板捕获定期快照以进行历史分析：

- **自动捕获**每个刷新周期
- **7天保留**并自动清理
- **存储数据**：新闻集群、市场价格、预测值、热点级别
- **回放**：加载历史快照以查看过去的仪表板状态

基线（7 天和 30 天平均值）存储在 IndexedDB 中以进行偏差分析。

---

## 海事情报

船舶层通过 AIS（自动识别系统）数据提供实时船舶跟踪和海域感知。

### 阻塞点监控

该系统监控八个关键的海上阻塞点，这些阻塞点的中断可能会影响全球贸易：

|阻塞点 |战略重要性|
|------------|---------------------|
| **霍尔木兹海峡** |全球石油运输量的20%；伊朗控制|
| **苏伊士运河** |欧亚航运；单点故障|
| **马六甲海峡** |亚太主要石油航线|
| **曼德城门** |红海通道；也门/胡塞武装活动 |
| **巴拿马运河** |美洲东西向过境|
| **台湾海峡** |半导体供应链；解放军活动 |
| **南海** |有争议的水域；岛屿争端|
| **黑海** |乌克兰谷物出口；俄罗斯海军活动|

### 密度分析

船舶位置被聚合到 2° 网格中以计算交通密度。每个单元格跟踪：
- 当前船只数量
- 历史基线（30 分钟滚动窗口）
- 相对于基线的变化百分比

±30% 的密度变化会触发警报，表明潜在的拥堵、改道或封锁。

### 暗船检测

该系统监视 AIS 间隙，即停止传输其位置的船只。在受监控区域中 AIS 差距超过 60 分钟可能表明：
- 逃避制裁（船对船转运）
- 非法捕鱼
- 军事活动
- 设备故障

在会话期间标记间隙后重新出现的船只。

### WebSocket 架构

AIS 数据流经 WebSocket 中继进行实时更新，无需轮询：

```
AISStream → WebSocket Relay → Browser
              (ws://relay)
```

连接断开后会自动重新连接，并有 30 秒的退避时间。当 Ships 层被禁用时，WebSocket 会断开连接以节省资源。

### 铁路中继架构

某些 API 会阻止来自云提供商（Vercel、AWS、Cloudflare Workers）的请求。铁路中继服务器提供经过身份验证的访问：

```
Browser → Railway Relay → External APIs
           (Node.js)      (AIS, OpenSky, RSS)
```

**继电器功能**：

|端点|目的|认证|
|----------|---------|----------------|
| `/`（WebSocket）| AIS 船舶流 | AISStream API 密钥 |
| `/opensky` |军用飞机| OAuth2 不记名令牌 |
| `/rss` |阻止 RSS 提要 |无（用户代理欺骗）|
| `/health` |状态检查 |无 |

**环境变量**（铁路）：
- `AISSTREAM_API_KEY` - AIS 数据访问
- `OPENSKY_CLIENT_ID` - OAuth2 客户端 ID
- `OPENSKY_CLIENT_SECRET` - OAuth2 客户端密钥

**为什么选择铁路？**
- 住宅IP范围（不像云提供商那样被阻止）
- WebSocket 支持持久连接
- 全球边缘部署以实现低延迟
- 免费套餐足以满足中等流量

中继是无状态的——它只是验证和代理请求。所有缓存和处理都发生在客户端或 Vercel Edge Functions 中。

---

## 军事追踪

军事层提供对军用船只和飞机的专门跟踪，通过应答器特性识别资产并监控活动模式。

### 军舰识别

通过多种方法将船只识别为军用：

**MMSI 分析**：海事移动服务识别号对船舶的船旗国进行编码。该系统维护 150 多个国家/地区代码的映射，以识别海军舰艇：

|中档 |国家 |笔记|
|-----------|---------|-------|
| 338-339 | 338-339美国 |美国海军、海岸警卫队 |
| 273 | 273俄罗斯 |俄罗斯海军|
| 412-414 | 412-414中国 |海军舰艇 |
| 232-235 | 232-235英国 |皇家海军|
| 226-228 | 226-228法国 |国家海军 |

**已知船舶数据库**：由 50 多艘命名船舶组成的精选数据库可在 AIS 传输船舶名称时进行积极识别：

|类别 |履带式船只|
|----------|-----------------|
| **美国运营商** |所有 11 艘尼米兹/福特级（CVN-68 至 CVN-78）|
| **英国运营商** |伊丽莎白女王号 (R08)、威尔士亲王号 (R09) |
| **中国运营商** | Liaoning (16), Shandong (17), Fujian (18) |
| **俄罗斯运营商** |库兹涅佐夫海军上将 |
| **著名驱逐舰** | USS Zumwalt (DDG-1000)、HMS Defender (D36)、HMS Duncan (D37) |
| **研究/英特尔** |胜利号 (T-AGOS-19)、无瑕号 (T-AGOS-23)、王远 |

**船舶分类算法**：

1.根据已知数据库检查船名（船体号和船名）
2. 如果名称匹配失败，则回退至 AIS 船舶类型代码
3. 应用 MMSI 模式匹配来识别国家/运营商
4. 对于海军前缀舰艇（USS、HMS、HMCS、HMAS、INS、JS、ROKS、TCG），推断军事状态

**呼号模式**：已知的军事呼号前缀（NAVY、GUARD 等）提供辅助识别。

### 海军阻塞点监控

该系统通过可配置的检测半径监控 12 个关键的海上阻塞点：

|阻塞点 |战略意义 |
|------------|----------------------|
|霍尔木兹海峡 |波斯湾通道、石油运输|
|苏伊士运河 |地中海-红海航线 |
|马六甲海峡 |太平洋-印度洋航线|
|台湾海峡|海峡两岸紧张局势 |
|博斯普鲁斯海峡 |黑海通道 |
| GIUK 差距 |北大西洋海底航线|

当军舰进入这些区域时，就会产生接近警报。

### 海军基地邻近度

追踪 12 个主要海军设施附近的活动：

- **诺福克**（美国）- 大西洋舰队总部
- **珍珠港**（美国）- 太平洋舰队基地
- **塞瓦斯托波尔**（俄罗斯） - 黑海舰队
- **青岛**（中国）- 北海舰队
- **横须贺**（日本） - 美国第七舰队

这些基地 50 公里范围内的船只都会被标记，从而能够检测到异常活动模式。

### 飞机跟踪 (OpenSky)

军用飞机通过 OpenSky 网络使用 ADS-B 数据进行跟踪。 OpenSky 会阻止来自云提供商 IP（Vercel、Railway、AWS）的未经身份验证的请求，因此飞机跟踪需要具有凭据的中继服务器。

**验证**：
- 在 [opensky-network.org](https://opensky-network.org) 注册免费帐户
- 在帐户设置中创建 API 客户端以获取 `OPENSKY_CLIENT_ID` 和 `OPENSKY_CLIENT_SECRET`
- 中继使用**OAuth2客户端凭证流**来获取承载令牌
- 令牌被缓存（30 分钟到期）并自动刷新

**识别方法**：
- **呼号匹配**：已知的军事呼号模式（RCH、REACH、DUKE 等）
- **ICAO 十六进制范围**：军用飞机使用按国家分配的十六进制代码块
- **高度/速度曲线**：不寻常的飞行特性

**跟踪指标**：
- 持仓历史记录（5 分钟窗口内 20 点轨迹）
- 高度和地面速度
- 标题和轨迹

**活动检测**：
- 编队（附近有多架军用飞机）
- 不寻常的模式（等待、侦察轨道）
- 阻塞点过境

### 船舶位置历史记录

系统维护跟踪船只的位置轨迹：

- **每个 MMSI 30 点历史记录**
- **过时数据的清理间隔**为 10 分钟
- **轨迹可视化**在地图上显示最近的移动

这使得能够检测徘徊、盘旋或其他异常行为模式。

### 军事激增检测

该系统持续监控军用飞机活动，以检测**激增事件**——超出正常运行基线的显着增加，这可能表明动员、演习或危机应对。

**剧场分类**

对五个地理战区的军事活动进行了分析：

|剧院 |覆盖范围|重点领域 |
|---------|----------|-----------|
| **中东** |波斯湾、黎凡特、阿拉伯半岛 |美国中央司令部在伊朗领空的活动|
| **东欧** |乌克兰、波罗的海、黑海 |北约-俄罗斯边境活动|
| **西欧** |中欧、北海 |北约演习、空中警务|
| **太平洋** |东亚、东南亚|台湾海峡、朝鲜半岛|
| **非洲之角** |东非红海 |反海盗、胡塞武装活动|

**飞机分类**

飞机按呼号模式匹配进行分类：

|类型 |呼号模式|意义 |
|------|-------------------|--------------|
| **交通** | RCH、REACH、MOOSE、HERKY、EVAC、DUSTOFF |空运行动、部队调动|
| **战斗机** |毒蛇、老鹰、猛禽、攻击 |战斗空中巡逻、拦截|
| **侦察** | SIGNT、COBRA、RIVET、JSTARS |情报收集|

**基线计算**

系统维护每个剧院的 48 小时滚动活动基线：
- 可靠基线至少需要 6 个数据样本
- 数据不足时的默认基线：3架运输机、2架战斗机、1架侦察机
- 活动低于基线的 50% 表示停止

**浪涌检测算法**

```
surge_ratio = current_count / baseline
surge_triggered = (
  ratio ≥ 2.0 AND
  transport ≥ 5 AND
  fighters ≥ 4
)
```

**浪涌信号输出**

当检测到浪涌时，系统会生成 `military_surge` 信号：

|领域|内容 |
|-------|---------|
| **位置** |剧院质心坐标|
| **留言** | “[战区]军事运输激增：[X]架飞机（基线：[Y]）”|
| **详情** |飞机类型、附近基地（半径 150 公里）、主要呼号 |
| **信心** |基于喘振比 (0.6–0.9) |

### 外国军事存在检测

除了激增检测之外，该系统还监视**敏感地区的外国军用飞机**，即来自一个国家的飞机出现在其正常运行范围之外的地缘政治重要区域的情况。

**敏感区域**

该系统追踪 18 个具有战略意义的地理区域：

|地区 |灵敏度|监控 |
|--------|-------------|---------------|
| **台湾海峡** |关键|中国空军的活动，美国过境|
| **波斯湾** |关键|伊朗、美国、海湾国家的活动|
| **波罗的海** |高|俄罗斯在北约附近的活动|
| **黑海** |高|北约侦察、俄罗斯活动|
| **南海** |高|中国空军巡逻、美国航行自由行动 |
| **朝鲜半岛** |高|朝鲜活动、美韩演习 |
| **东地中海** |中等|俄罗斯海军航空兵、北约|
| **北极** |中等|俄罗斯轰炸机巡逻|

**检测逻辑**

对于每个敏感区域，系统：
1.识别区域边界内的所有军用飞机
2. 按运营国家对飞机进行分组
3. 排除“本土地区”运营商（例如，波罗的海的俄罗斯 VKS 被排除在警报之外）
4. 应用浓度阈值（通常每个运营商 2-3 架飞机）

**关键组合**

某些运营商区域组合会触发**严重程度**警报：

|操作员|地区 |理由|
|----------|--------|-----------|
|中国空军 |台湾海峡|潜在入侵演习|
|俄罗斯 VKS |北极|核轰炸机巡逻|
|美国空军 |波斯湾 |潜在的罢工计划|

**信号输出**

异物存在检测会生成 `foreign_military_presence` 信号：

|领域|内容 |
|-------|---------|
| **标题** | “外国军事存在：[地区]”|
| **详情** | “[操作员] 检测到飞机：[计数] [类型]”|
| **严重性** |基于组合的临界/高/中 |
| **信心** | 0.7–0.95 基于飞机数量和类型多样性 |

---

## 飞机浓缩

**Wingbits** 丰富数据增强了军用飞机跟踪功能，提供了超出基本转发器数据的详细飞机信息。

### Wingbits 提供什么

当通过 OpenSky ADS-B 检测到飞机时，系统会查询 Wingbits：

|领域|描述 |使用案例|
|-------|-------------|----------|
| **注册** |飞机尾号（例如 N12345）|唯一标识|
| **所有者** |飞机的合法拥有者 |军事部门检测|
| **操作员** |经营实体|区分军队与承包商|
| **制造商** |波音、洛克希德·马丁等|飞机型号分类 |
| **型号** |具体机型|能力评估|
| **建成年份** |制造年份 |机队年龄分析|

### 军事分类算法

丰富服务根据策划的关键字列表分析所有者和运营商字段：

**确认的军事**（所有者/操作员匹配）：
- 政府：“美国空军”、“国防部”、“皇家空军”
- 国际：“北约”、“国防部”、“联邦国防军”

**可能是军事**（运营商 ICAO 代码）：
- `AIO`（空中机动司令部）、`RRR`（英国皇家空军）、`GAF`（德国空军）
- `RCH`（REACH 航班）、`CNV`（护航航班）、`DOD`（国防部）

**可能的军事**（国防承包商）：
- 诺斯罗普·格鲁曼公司、洛克希德·马丁公司、通用原子公司、雷神公司、波音防务公司、L3Harris

**机型匹配**：
- 运输：C-17、C-130、C-5、KC-135、KC-46
- 侦察：RC-135、U-2、RQ-4、E-3、E-8
- 战斗：F-15、F-16、F-22、F-35、B-52、B-2
- 欧洲：欧洲战斗机、台风、阵风、龙卷风、鹰狮

### 置信度

每架丰富的飞机都会收到一个置信度分类：

|水平|标准|显示|
|-------|----------|---------|
| **已确认** |直接军事所有者/经营者匹配|绿色徽章|
| **可能** |军用 ICAO 代码或飞机类型 |黄色徽章|
| **可能** |国防承包商所有权|灰色徽章|
| **民用** |没有军事指标|没有徽章 |

### 缓存策略

飞机细节很少改变，因此积极的缓存可以减少 API 负载：

- **服务器端**：HTTP 缓存控制标头（24 小时最大期限）
- **客户端**：每架飞机 1 小时本地缓存
- **批量优化**：每次 API 调用最多 20 架飞机

这意味着飞机的详细信息每天最多获取一次，无论它在地图上出现多少次。

---

## 太空发射基础设施

太空港图层显示用于监控太空相关活动和供应链影响的全球发射设施。

### 跟踪发射站点

|网站 |国家 |操作员|活动水平|
|------|---------|----------|----------------|
| **肯尼迪航天中心** |美国 |美国宇航局/太空部队 |高|
| **范登堡 SFB** |美国 |美国太空部队 |中等|
| **星际基地** |美国 |太空探索技术公司 |高|
| **拜科努尔航天发射场** |哈萨克斯坦 |俄罗斯航天局 |中等|
| **普列谢茨克航天发射场** |俄罗斯 |俄罗斯航天局/军事 |中等|
| **东方航天发射场** |俄罗斯 |俄罗斯航天局 |低|
| **酒泉SLC** |中国 |国家航天局|高|
| **西昌SLC** |中国 |国家航天局|高|
| **文昌SLC** |中国 |国家航天局|中等|
| **圭亚那航天中心** |法国 |欧空局/法国国家空间研究中心 |中等|
| **萨蒂什·达万 SC** |印度 |印度空间研究组织|中等|
| **种子岛SC** |日本 |日本宇宙航空研究开发机构 |低|

### 为什么这很重要

太空发射具有地缘政治意义：
- **军事影响**：许多发射都是双重用途的（民用/军用）
- **技术竞赛**：发射节奏表明太空计划的进展
- **供应链**：卫星服务影响通信、GPS、侦察
- **事件关联**：有关空间碎片、发射失败或政策变化的新闻

---

## 关键矿藏

矿物图层显示对现代技术和国防供应链至关重要的战略矿物开采地点。

### 跟踪资源

|矿物 |战略重要性|主要生产商|
|---------|---------------------|-----------------|
| **锂** |电动汽车电池、储能 |澳大利亚、智利、中国 |
| **钴** |电池阴极、超级合金|刚果民主共和国（全球 60% 以上）、澳大利亚 |
| **稀土** |磁铁、电子、国防 |中国（全球 60% 以上）、澳大利亚、美国 |

### 关键站点

|网站 |矿物 |国家 |意义 |
|------|---------|---------|--------------|
|绿色灌木 |锂|澳大利亚 |世界最大硬岩锂矿|
|阿塔卡马盐沼|锂|智利 |最大的卤水锂源|
|穆坦达 |钴 |刚果民主共和国 |世界最大钴矿|
| Tenke Fungurume |钴 |刚果民主共和国 |中资主要钴产地|
|白云鄂博|稀土 |中国 |占全球 REE 产量的 45% |
|山口 |稀土 |美国 |美国唯一活跃的稀土矿 |

### 供应链风险

关键矿物在地缘政治上集中：
- **钴**：70% 来自刚果民主共和国，手工采矿存在重大问题
- **稀土**：60%来自中国，加工几乎被垄断
- **锂**：产量扩大但需求超过供应

有关这些地区或矿业公司的消息可能预示着影响技术和国防部门的供应中断。

---

## 网络威胁参与者（APT 组织）

该地图显示了主要国家资助的高级持续威胁 (APT) 组织的地理归因标记。这些标记显示了已知威胁行为者的大致行动中心。

### 跟踪组

|集团|别名 |赞助商 |值得注意的活动 |
|-------|---------|---------|-----------------|
| **APT28/29** |花哨的小熊，舒适的小熊|俄罗斯（GRU/FSB）|选举干扰、政府间谍活动 |
| **APT41** |双龙|中国（MSS）|供应链攻击、知识产权盗窃|
| **拉撒路** |隐藏的眼镜蛇 |朝鲜 (RGB) |金融盗窃、加密货币抢劫 |
| **APT33/35** |小精灵，迷人的小猫 |伊朗 (IRGC) |关键基础设施，航空航天瞄准|

### 为什么这很重要

网络行动通常与地缘政治紧张局势相关。当新闻报道提到乌克兰升级期间的俄罗斯网络活动或中东紧张局势期间伊朗的黑客活动时，这些标记为威胁形势提供了地理背景。

### 视觉指示器

APT 标记显示为具有独特样式的警告三角形 (⚠)。单击标记会显示：
- **官方名称**和常见别名
- **国家赞助商**和情报机构
- **主要目标行业**

---

## 社会动荡追踪

抗议层汇总了来自两个独立来源的内乱数据，提供佐证和全球覆盖。

### ACLED（武装冲突地点和事件数据）

学术级冲突数据与经过人工验证的事件：
- **覆盖范围**：全球、30 天滚动窗口
- **事件类型**：抗议、骚乱、罢工、示威
- **元数据**：涉及的演员、死亡人数、详细说明
- **置信度**：高（人工策划）

### GDELT（全球事件、语言和语气数据库）

实时新闻衍生事件数据：
- **覆盖范围**：全球、7 天滚动窗口
- **事件类型**：对新闻中提及的抗议进行地理编码
- **音量**：每个位置的报告（信号强度）
- **置信度**：中等（算法提取）

### 多源证实

使用 0.5° 空间网格和日期匹配对两个来源的事件进行重复数据删除。当 ACLED 和 GDELT 报告同一区域的事件时：
- 信心提升至“高”
- ACLED数据优先（精度更高）
- 来源列表显示佐证

### 严重程度分类

|严重程度 |标准|
|----------|----------|
| **高** |据报道死亡、骚乱或冲突|
| **中** |大型示威、罢工|
| **低** |规模较小的抗议活动，局部事件|

情报热点附近的事件被交叉引用以提供地缘政治背景。

### 地图显示过滤

为了减少视觉混乱并将注意力集中在重大事件上，地图仅显示**严重程度的抗议和骚乱**：

|显示 |事件类型 |视觉 |
|-----------|------------|--------|
| ✅ 是的 |暴动|亮红色标记|
| ✅ 是的 |高度严重的抗议|红色标记|
| ❌ 否 |中度/低度抗议 |地图上未显示|

仍会跟踪严重程度较低的事件以进行 CII 评分和数据导出——它们只是不创建地图标记。这种过滤可以防止密集的城市地区（自然会产生更多低严重程度的示威活动）淹没地图显示。

---

## 航空监控

航班图层使用 FAA NASSTATUS 数据跟踪美国主要机场的机场延误和地面停留。

### 延迟类型

|类型 |描述 |
|------|-------------|
| **地面站** |不允许出发；严重扰乱|
| **地面延误** |出发；到达率限制 |
| **抵达延误** |入站流量备份 |
| **出发延误** |出境交通延误 |

### 严重性阈值

|严重程度 |平均延误|视觉 |
|----------|--------------|--------|
| **严重** | ≥60分钟|红色|
| **专业** | 45-59 分钟 |橙色|
| **中等** | 25-44 分钟 |黄色|
| **轻微** | 15-24 分钟 |灰色|

### 受监控的机场

追踪美国 30 个最大的机场：
- 主要枢纽：JFK、LAX、ORD、ATL、DFW、DEN、SFO
- 高人流量的国际门户
- 经常受天气或拥堵影响的机场

地面停留尤其重要——它们表明严重的破坏（天气、安全或基础设施故障），并且可能会在整个网络中级联。

---

## 安全和输入验证

仪表板处理来自数十个外部来源的不受信任的数据。深度防御措施可防止注入攻击和 API 滥用。

### XSS预防

所有用户可见的内容在 DOM 插入之前都会被清理：

```typescript
escapeHtml(str)  // Encodes & < > " ' as HTML entities
sanitizeUrl(url) // Allows only http/https protocols
```

这适用于：
- 新闻标题和来源（RSS 提要）
- 搜索结果和亮点
- 监控关键字（用户输入）
- 地图弹出内容
- 张力对标签

搜索中突出显示的 `<mark>` 在换行匹配之前转义文本，从而防止通过精心设计的搜索查询进行注入。

### 代理端点验证

无服务器代理函数验证并限制所有参数：

|端点|验证 |
|----------|------------|
| `/api/yahoo-finance` |符号格式 `[A-Za-z0-9.^=-]`，最多 20 个字符 |
| `/api/coingecko` |硬币 ID 字母数字+连字符，最多 20 个 ID |
| `/api/polymarket` |订单字段白名单，限制为 1-100 |

这可以防止上游 API 滥用和格式错误请求导致的速率限制耗尽。

### 内容安全

- URL 通过 `URL()` 构造函数进行验证 - 仅允许 `http:` 和 `https:` 协议
- 外部链接使用 `rel="noopener"` 来防止反向 tabnapping
- 没有内联脚本或 `eval()` — 所有代码都在构建时捆绑

---

## 容错

外部 API 不可靠。速率限制、中断和网络错误是不可避免的。系统实施**断路器**模式来保持可用性。

### 断路器模式

每个外部服务都包含在一个跟踪故障的断路器中：

```
Normal → Failure #1 → Failure #2 → OPEN (cooldown)
                                      ↓
                              5 minutes pass
                                      ↓
                                   CLOSED
```

**冷却期间的行为：**
- 新请求返回缓存数据（如果可用）
- UI 显示“暂时不可用”状态
- 不进行 API 调用（防止锤击）

### 受保护的服务

|服务 |冷却时间|缓存 TTL |
|---------|----------|-----------|
|雅虎财经 | 5 分钟 | 10 分钟 |
|综合市场 | 5 分钟 | 10 分钟 |
|美国地质调查局地震 | 5 分钟 | 10 分钟 |
| NWS 天气 | 5 分钟 | 10 分钟 |
| FRED经济| 5 分钟 | 10 分钟 |
| Cloudflare 雷达 | 5 分钟 | 10 分钟 |
| ACLED | 5 分钟 | 10 分钟 |
| GDELT | 5 分钟 | 10 分钟 |
|美国联邦航空局状态 | 5 分钟 | 5 分钟 |
| RSS 源 |每次喂食 5 分钟 | 10 分钟 |

RSS 提要使用每个提要断路器 — 一个失败的提要不会影响其他提要。

### 优雅的降级

当服务进入冷却时：
1. 缓存数据继续显示（陈旧但可用）
2.状态面板显示服务健康状况
3.冷却时间结束自动恢复
4. 无需用户干预

---

## 系统健康监控

状态面板（通过标题中的运行状况指示器访问）提供数据源状态和系统运行状况的实时可见性。

### 健康指标

标题显示系统运行状况徽章：

|状态|视觉 |意义|
|-------|--------|---------|
| **健康** |绿点|所有数据源均可运行 |
| **降级** |黄点|一些资源处于冷却状态|
| **不健康** |红点|多个来源失败 |

单击该指示器可展开完整的状态面板。

### 数据源状态

状态面板列出了所有数据源及其当前状态：

|状态 |图标|描述 |
|--------|------|-------------|
| **活跃** | ●绿色|正常获取数据 |
| **冷却** | ● 黄色|暂时暂停（断路器）|
| **已禁用** | ○ 灰色 |图层未启用 |
| **错误** | ● 红色|持续失败|

### 每次提要信息

每个提要条目显示：
- **来源名称** - 数据提供者
- **上次更新** - 自上次成功获取以来的时间
- **下一次刷新** - 下一次计划获取的倒计时
- **剩余冷却时间** - 断路器重置之前的时间（如果处于冷却时间）

### 为什么这很重要

外部 API 不可靠。状态面板可帮助您了解：
- **数据新鲜度** - 新闻源是最新的还是过时的？
- **覆盖范围差距** - 哪些来源目前不可用？
- **恢复时间表** - 失败的源何时重试？

这种透明度使得仪表板数据能够得到明智的解释。

---

## 数据新鲜度跟踪

除了简单的“在线/离线”状态之外，系统还跟踪每个数据源的细粒度新鲜度，以指示数据的可靠性和陈旧性。

### 新鲜度

|状态 |颜色 |标准|意义|
|--------|-------|----------|---------|
| **新鲜** |绿色|在预期间隔内更新 |数据为最新数据 |
| **老化** |黄色| 1-2× 预期间隔已过 |数据可能有点陈旧 |
| **陈旧** |橙色| 2-4× 预期间隔已过 |数据已过时 |
| **关键** |红色| >4× 预期间隔已过 |数据不可靠 |
| **已禁用** |灰色|图层已关闭 |不抓取|

### 源特定阈值

每个数据源都有校准的新鲜度期望：

|来源 |预期间隔 | “新鲜”门槛|
|--------|------------------|-------------------|
|新闻提要 | 5 分钟 | <10 分钟 |
|股票行情| 1 分钟 | <5 分钟 |
|地震 | 5 分钟 | <15 分钟 |
|天气 | 10 分钟 | <30 分钟 |
|航班延误 | 10 分钟 | <20 分钟 |
| AIS 船舶 |实时 | <1 分钟 |

### 视觉指示器

状态面板显示每个源的新鲜度：
- **彩色点**表示新鲜度
- **自更新以来的时间**显示确切的陈旧性
- **下次刷新倒计时**显示数据何时更新

### 为什么这很重要

了解数据新鲜度对于决策至关重要：
- “新鲜”地震源意味着显示最近的事件
- “陈旧”的新闻源意味着您可能会错过重大新闻
- “关键”AIS 流意味着船舶位置不可靠

这种可见性可以在解释仪表板时进行适当的置信度校准。

### 核心源与可选源

数据源根据其对风险评估的重要性进行分类：

|分类|来源 |影响 |
|----------------|---------|--------|
| **核心** | GDELT、RSS 提要 |需要有意义的风险评分 |
| **可选** | ACLED、军事、AIS、天气、经济 |增强但不是必需的 |

战略风险概述面板根据核心源可用性调整其显示：

|状态 |显示模式 |行为 |
|--------|--------------|----------|
| **足够** |完整数据查看 |所有指标均充满信心 |
| **有限** |有限的数据查看|显示“有限数据”警告横幅 |
| **不足** |数据视图不足 | “数据不足”消息，无风险评分 |

### 新鲜度风险评估

综合风险评分根据数据新鲜度进行调整：

```
If core sources fresh:
  → Full confidence in risk score
  → "All data sources active" indicator

If core sources stale:
  → Display warning: "Limited Data - [active sources]"
  → Score shown but flagged as potentially unreliable

If core sources unavailable:
  → "Insufficient data for risk assessment"
  → No score displayed
```

当系统实际上缺乏数据来做出决定时，这可以防止出现错误的“全部清除”信号。

---

## 条件数据加载

API 调用的成本很高。系统仅获取**启用层**的数据，减少不必要的网络流量和速率限制消耗。

### 层感知加载

当图层关闭时：
- 没有对该数据源的 API 调用
- 没有安排刷新间隔
- WebSocket 连接关闭（对于 AIS）

当图层打开时：
- 立即获取数据
- 刷新间隔开始
- 切换按钮上显示加载指示器

### 未配置的服务

某些数据源需要 API 密钥（AIS 中继、Cloudflare Radar）。如果未配置凭据：
- 图层切换完全隐藏
- 没有失败的请求污染控制台
- 用户只能看到功能层

这可以防止在没有完整 API 访问权限的情况下进行部署时出现混乱。

---

## 性能优化

仪表板实时处理数千个数据点。即使在数据负载很重的情况下，也有多种技术可以使 UI 保持响应。

### 用于分析的 Web Worker

CPU 密集型操作在专用 Web Worker 中运行，以避免阻塞主线程：

|运营|复杂性 |工人？ |
|-----------|------------|---------|
|新闻聚类（Jaccard） | O(n²) | ✅ 是的 |
|相关性检测| O(n × m) | ✅ 是的 |
| DOM 渲染 | O(n) | ❌ 主线程 |

工人经理实施：
- **延迟初始化**：Worker 在第一次使用时生成
- **10秒就绪超时**：如果worker初始化失败则拒绝
- **30 秒请求超时**：防止卡住操作时挂起
- **自动清理**：因致命错误而终止工作人员

### 虚拟滚动

大型列表（100 多个新闻项）使用虚拟化渲染：

**固定高度模式**（虚拟列表）：
- 仅渲染视口中可见的项目 + 3 项目过扫描缓冲区
- 元素池——重用 DOM 节点而不是创建新节点
- 不可见的间隔保持滚动位置而不渲染所有项目

**可变高度模式**（WindowedList）：
- 基于块的渲染（每个块 10 个项目）
- 使用 1 块缓冲区渲染滚动块
- 用于性能隔离的 CSS 遏制

这将 DOM 节点数量从数千减少到约 30，从而显着提高了滚动性能。

### 请求重复数据删除

短窗口内的相同请求将被删除重复：
- 市场报价将多个交易品种批处理为单个 API 调用
- 并发层切换不会产生重复的提取
- `Promise.allSettled` 确保一个失败的请求不会阻止其他请求

### 高效的数据更新

刷新数据时：
- **增量更新**：只有更改的项目才会触发重新渲染
- **重新验证时陈旧**：获取完成时显示旧数据
- **增量压缩**：基线存储 7 天/30 天的增量，而不是原始历史记录

---

## 预测市场过滤

预测市场小组专注于**地缘政治相关**市场，过滤掉体育和娱乐。

### 包含关键字

显示与这些主题匹配的市场：
- **冲突**：战争、军事、入侵、停火、北约、核
- **国家**：俄罗斯、乌克兰、中国、台湾、伊朗、以色列、加沙
- **领导人**：普京、泽伦斯基、特朗普、拜登、习近平、内塔尼亚胡
- **经济**：美联储、利率、通货膨胀、衰退、关税、制裁
- **全球**：联合国、欧盟、条约、峰会、政变、难民

### 排除关键字

与这些匹配的市场被过滤掉：
- **体育**：NBA、NFL、FIFA、世界杯、锦标赛、季后赛
- **娱乐**：奥斯卡、电影、名人、TikTok、流媒体

这确保了该小组向市场展示“俄罗斯会从乌克兰撤军吗？”之类的内容。而不是“湖人会夺冠吗？”

---

## 面板管理

仪表板将数据组织到**可拖动、可折叠的面板**中，以在会话中保留用户首选项。

### 拖动重新排序

可以通过拖动来重新组织面板：

1. 抓住面板标题（悬停时出现抓握图标）
2. 拖至所需位置
3. 下拉重新排序
4.新订单自动保存到LocalStorage

这可以实现个性化布局——将最受关注的面板放在顶部。

### 面板可见性

通过“设置”菜单 (⚙) 打开/关闭面板：

- **隐藏面板**：不渲染，不获取数据
- **可见面板**：完整功能
- **折叠面板**：仅标题，数据仍然刷新

隐藏面板与禁用图层不同 - 面板本身不会出现在界面中。

### 默认面板顺序

小组按情报优先级组织：

|优先|面板|目的|
|----------|--------|---------|
| **关键** |战略风险，实时英特尔|即时态势感知 |
| **小学** |新闻、CII、市场 |核心监测数据|
| **支持** |预测、经济、监测|补充分析|
| **参考** |现场新闻视频|背景语境|

### 坚持

面板状态在浏览器重新启动后仍然存在：

- **LocalStorage**：面板顺序、可见性、折叠状态
- **自动保存**：更改立即保留
- **每设备**：设置特定于浏览器（不同步）

---

## 移动体验

仪表板针对移动设备进行了优化，具有简化的界面，优先考虑小屏幕上的可用性。

### 首次使用移动设备欢迎

首次在移动设备上访问仪表板时，欢迎模式会解释移动优化的体验：

- **简化的视图通知** - 通知用户他们正在看到精选的移动版本
- **导航提示** - 解释区域视图按钮和标记交互
- **“不再显示”选项** - 未来访问时跳过的复选框（保留到本地存储）

### 移动优先设计

在窄于 768px 的屏幕或触摸设备上：

- **紧凑地图** - 降低高度 (40vh) 以显示更多面板
- **单列布局** - 面板垂直堆叠以便于滚动
- **隐藏地图标签** - 所有标记标签都被隐藏以减少视觉混乱
- **固定图层集** - 隐藏图层切换按钮；默认情况下启用一组精选的图层
- **简化的控制** - 地图调整大小手柄和图钉按钮被隐藏
- **触摸优化标记** - 扩展触摸目标 (44 像素)，方便点击
- **隐藏 DEFCON 指示器** - 隐藏五角大楼披萨索引以减少标题混乱
- **隐藏焦点选择器** - 隐藏区域焦点按钮（改为使用预设视图）
- **紧凑标题** - 社交链接显示 X 徽标而不是用户名文本

### 移动默认图层

移动体验侧重于最基本的智能层：

|层 |目的|
|-------|---------|
| **冲突** |活跃的冲突地区|
| **热点** |具有活动水平的情报热点|
| **制裁** |受到经济制裁的国家|
| **停电** |网络中断 |
| **自然** |地震、风暴、野火|
| **天气** |恶劣天气警告|

默认情况下，移动设备上禁用图层（但在桌面上可用）：
- 军事基地、核设施、航天发射场、矿产
- 海底电缆、管道、数据中心
- AIS 船舶、军用航班
- 抗议、经济中心

这个精选集提供了态势感知，而不会压垮界面或消耗过多的数据/电池。

### 触摸手势

地图导航支持：

- **双指缩放** - 两指放大/缩小
- **拖动平移** - 单指地图移动
- **点击标记** - 显示弹出窗口（取代悬停）
- **双击** - 快速缩放

### 性能考虑因素

移动优化减少资源消耗：

|优化|效益 |
|--------------|---------|
|更少的层数 |减少 API 调用，降低电池使用量 |
|没有标签|更快的渲染，更干净的界面 |
|隐藏控件|更多的屏幕空间用于内容 |
|简化标题 |减少视觉处理|

### 桌面体验

在较大的屏幕上，可以使用完整的功能集：

- 多列响应式面板网格
- 所有图层均可切换
- 地图标签在适当的缩放级别可见
- 可调整大小的地图部分
- 可固定地图（滚动面板时保持地图可见）
- 带张力对的完整 DEFCON 指示器
- FOCUS 区域选择器用于快速导航

---

## 能量流检测

关联引擎检测与能源基础设施和商品市场相关的信号。

### 管道关键字

系统监视与管道相关事件的新闻：

**基础设施术语**：管道、管道爆炸、管道泄漏、管道攻击、管道破坏、管道中断、nord Stream、keystone、druzhba

**流量指标**：天然气流量、石油流量、供应中断、运输停止、产能减少

### 流量下降信号

当新闻提到流量中断时，可能会触发两种信号类型：

|信号|标准|意义|
|--------|----------|---------|
| **流量下降** |管道关键词+颠覆术语|潜在的供应中断|
| **流量价格背离** |流量下降消息 + 油价稳定（< 1.50 美元变动） |市场尚未消化颠覆的影响

### 为什么这很重要

能源供应中断会产生连锁效应：

1. **即时**：现货价格波动
2. **短期**：工业生产影响
3. **长期**：地缘政治杠杆变化

及早发现流量下降（尤其是在市场尚未做出反应时）可提供信息优势。

---

## 信号聚合器

信号聚合器是收集、分组和汇总来自所有数据源的情报信号的中枢神经系统。

### 它聚合了什么

|信号类型|来源 |频率|
|-------------|--------|-----------|
| `military_flight` | OpenSky ADS-B |实时 |
| `military_vessel` | AIS WebSocket |实时 |
| `protest` | ACLED + GDELT |每小时 |
| `internet_outage` | Cloudflare 雷达 | 5 分钟 |
| `ais_disruption` | AIS分析|实时 |

### 国家/地区级别分组

所有信号均按国家代码分组，创建统一视图：

```typescript
{
  country: 'UA',  // Ukraine
  countryName: 'Ukraine',
  totalCount: 15,
  highSeverityCount: 3,
  signalTypes: Set(['military_flight', 'protest', 'internet_outage']),
  signals: [/* all signals for this country */]
}
```

### 区域收敛检测

当多种信号类型聚集在同一区域时，聚合器会识别地理融合：

|收敛水平|标准|警报优先级 |
|-------------------|----------|----------------|
| **关键** | 200公里内4+信号类型 |立即 |
| **高** | 200公里内3种信号类型 |高|
| **中** | 200公里内2种信号类型 |正常 |

### 摘要输出

聚合器提供仪表板和 AI 上下文的实时摘要：

```
[SIGNAL SUMMARY]
Top Countries: Ukraine (15 signals), Iran (12), Taiwan (8)
Convergence Zones: Baltic Sea (military_flight + military_vessel),
                   Tehran (protest + internet_outage)
Active Signal Types: 5 of 5
Total Signals: 47
```

---

## 基于浏览器的机器学习

为了实现离线弹性和降低 API 成本，该系统包括使用 ONNX Runtime Web 的基于浏览器的 ML 功能。

### 可用型号

|型号|任务|尺寸|使用案例|
|-------|------|------|----------|
| **T5-小号** |文字摘要| 〜60MB |离线简报生成|
| **DistillBERT** |情感分析| ~67MB |新闻语气分类|

### 后备策略

当云 API 不可用时，浏览器 ML 可以作为最终的后备方案：

```
User requests summary
    ↓
1. Try Groq API (fast, free tier)
    ↓ (rate limited or error)
2. Try OpenRouter API (fallback provider)
    ↓ (unavailable)
3. Use Browser T5 (offline, always available)
```

### 延迟加载

模型按需加载，以最大限度地减少初始页面加载：
- 仅在第一次需要时下载模型
- 进度指示器显示下载状态
- 缓存后，模型立即从 IndexedDB 加载

### 工人隔离

所有 ML 推理都在专用的 Web Worker 中运行：
- 主线程在推理期间保持响应
- 30 秒超时可防止挂起
- 自动清除错误

### 限制

与云模型相比，浏览器机器学习有一些限制：

|方面|云（Llama 3.3）|浏览器（T5）|
|--------|-------------------|--------------|
|上下文窗口 | 128K 代币 | 512 代币 |
|输出质量|高|中等|
|推理速度 | 2-3 秒 | 5-10 秒 |
|离线支持 |没有 |是的 |

浏览器摘要有意限制为 6 个标题 × 80 个字符，以保持在模型限制范围内。

---

## 跨模块集成

情报模块并不是孤立运行的。数据在系统之间流动以实现复合分析。

### 数据流架构

```
News Feeds → Clustering → Velocity Analysis → Hotspot Correlation
                ↓                                    ↓
         Topic Extraction                    CII Information Score
                ↓                                    ↓
         Keyword Monitors              Strategic Risk Overview
                                                     ↑
Military Flights → Near-Hotspot Detection ──────────┤
                                                     ↑
AIS Vessels → Chokepoint Monitoring ────────────────┤
                                                     ↑
ACLED/GDELT → Protest Events ───────────────────────┤
                       ↓
                CII Unrest Score
```

### 模块依赖关系

|消费模块|数据来源|整合|
|----------------|-------------|-------------|
| **CII 动荡评分** | ACLED、GDELT 抗议 |事件计数、死亡人数 |
| **CII 安全评分** |军用航班、舰艇|热点附近的活动 |
| **CII 信息评分** |新闻集群|速度、关键词匹配|
| **战略风险** | CII、融合、级联 |综合评分|
| **相关资产** |新闻地点推断 |管道/电缆邻近度 |
| **地理融合** |所有地理定位事件 |多类型聚类|

### 警报传播

当超过阈值时：

1. **源模块**生成警报（例如，CII 尖峰）
2. **警报与相关警报合并**（同一国家/地区）
3. **战略风险**收到复合警报
4. **UI 更新** 标题徽章和面板指示器

这确保了单一升级（例如，乌克兰军事飞行+抗议+新闻激增）作为一个连贯的信号而不是三个单独的警报而出现。

---

## AI 见解面板

洞察面板提供人工智能对当前新闻形势的分析，将原始头条新闻转化为可操作的情报简报。

### 世界简报生成

每 2 分钟（有速率限制），系统会使用多提供商后备链生成一份简明的情况简介：

|优先|供应商|型号|延迟 |使用案例|
|----------|----------|-------|---------|----------|
| 1 |格罗克 |骆驼 3.3 70B | 〜2秒|主要提供者（快速推理）|
| 2 |开放路由器 |骆驼 3.3 70B | 〜3秒| Groq 速率受限时的回退 |
| 3 |浏览器 | T5（ONNX）| 〜5秒|离线后备（本地 ML）|

**缓存策略**：Redis 服务器端缓存可防止冗余的 API 调用。当最近对同一标题集进行汇总时，立即返回缓存结果。

### 焦点检测

人工智能接收有关**焦点**的丰富上下文——出现在新闻报道和地图信号中的实体。这可以实现情报级分析：

```
[INTELLIGENCE SYNTHESIS]
FOCAL POINTS (entities across news + signals):
- IRAN [CRITICAL]: 12 news mentions + 5 map signals (military_flight, protest, internet_outage)
  KEY: "Iran protests continue..." | SIGNALS: military activity, outage detected
- TAIWAN [ELEVATED]: 8 news mentions + 3 map signals (military_vessel, military_flight)
  KEY: "Taiwan tensions rise..." | SIGNALS: naval vessels detected
```

### 标题评分算法

并非所有新闻都同样重要。对标题进行评分是为了确定简报中最重要的故事：

**分数助推器**（高权重）：
- 军事关键词：战争、入侵、空袭、导弹、部署、动员
- 暴力指标：死亡、伤亡、冲突、屠杀、镇压
- 内乱：抗议、起义、政变、骚乱、戒严

**地缘政治乘数**：
- 闪点地区：伊朗、俄罗斯、中国、台湾、乌克兰、朝鲜、加沙
- 关键角色：北约、五角大楼、克里姆林宫、真主党、哈马斯、瓦格纳

**减分者**（降级）：
- 业务背景：首席执行官、收益、股票、收入、初创公司、数据中心
- 娱乐：名人、电影、流媒体

这确保了军事冲突和人道主义危机高于常规商业新闻。

### 情感分析

分析标题的整体情绪分布：

|感悟|检测方法|显示|
|-----------|------------------|---------|
| **负面** |危机、冲突、死亡关键词|红色百分比|
| **积极** |协议、增长、和平关键词|绿化率|
| **中性** |均未检测到 |灰度百分比|

整体情绪平衡可以让您快速了解新闻周期是趋于升级还是趋于降级。

### 速度检测

当同一主题出现在多个最近的头条新闻中时，快速发展的故事就会被标记：

- 标题按共享关键字和实体分组
- 6 小时内被提及 3 次以上的主题被标记为“高速”
- 单独显示以突出​​发展情况

---

## 焦点探测器

焦点检测器是情报合成层，它将新闻实体与地图信号相关联，以识别推动当前事件的“主角”。

### 它解决的问题

如果没有综合，情报流就会在孤岛中运行：
- 新闻源显示 80 多个来源和数千个标题
- 地图图层独立显示军事航班、抗议、停电
- 没有自动方式可以看到伊朗出现在新闻中、有军事活动以及互联网中断

### 它是如何运作的

1. **实体提取**：使用实体注册表从所有新闻集群中提取国家、公司和组织（600+具有别名的实体）

2. **信号聚合**：收集所有地图信号（军事航班、抗议、停电、船只）并按国家分组

3. **交叉引用**：将新闻实体与信号国家进行匹配

4. **分数和排名**：根据相关强度计算焦点分数

### 焦点评分

```
FocalScore = NewsScore + SignalScore + CorrelationBonus

NewsScore (0-40):
  base = min(20, mentionCount × 4)
  velocity = min(10, newsVelocity × 2)
  confidence = avgConfidence × 10

SignalScore (0-40):
  types = signalTypes.count × 10
  count = min(15, signalCount × 3)
  severity = highSeverityCount × 5

CorrelationBonus (0-20):
  +10 if entity appears in BOTH news AND signals
  +5 if news keywords match signal types (e.g., "military" + military_flight)
  +5 if related entities also have signals
```

### 紧急程度分类

|紧急|标准|视觉 |
|---------|----------|--------|
| **关键** |分数 > 70 或 3+ 信号类型 |红色徽章|
| **提升** |分数 > 50 或 2+ 信号类型 |橙色徽章|
| **观看** |默认 |黄色徽章|

### 信号类型图标

焦点显示图标指示哪些信号类型处于活动状态：

|图标|信号类型|意义|
|------|-------------|---------|
| ✈️ |军事飞行 |附近发现军用飞机|
| ⚡ |军舰 |水域中的海军舰艇 |
| 📢 |抗议|内乱事件|
| 🌐 |互联网中断 |网络中断 |
| 🚢 | ais_中断 |出货异常|

### 输出示例

伊朗的焦点可能会显示：
- **显示**：“伊朗 [关键] ✈️📢🌐”
- **新闻**：12 次提及，速度 0.5/小时
- **信号**：5 次军事飞行、3 次抗议、1 次停电
- **叙述**：“12 条新闻提及 | 5 次军事飞行、3 次抗议、1 次互联网中断 |‘伊朗抗议活动仍在继续......’”
- **相关证据**：“伊朗出现在新闻 (12) 和地图信号 (9) 中”

### 与 CII 集成

焦点紧急程度纳入国家不稳定指数：
- **关键** 焦点 → 该国家/地区的 CII 分数提升
- 确保多源融合的国家得到正确标记
- 当新闻本身不会触发警报时，防止“无声”不稳定

---

## 自然灾害追踪

自然层结合了两个权威来源进行综合灾害监测。

### GDACS（全球灾害警报和协调系统）

联合国支持的灾害警报系统提供官方严重程度评估：

|事件类型 |代码|图标|来源 |
|------------|------|------|---------|
|地震 |情商| 🔴 |美国地质调查局、紧急医疗服务中心 |
|洪水|佛罗里达 | 🌊 |卫星图像|
|热带气旋 | TC | 🌀 | NOAA、JMA |
|火山|画外音 | 🌋 |史密森尼 GVP |
|野火| WF | 🔥 | MODIS、VIIRS |
|干旱|博士| ☀️ |多个来源 |

**警报级别**：
|水平|颜色 |意义|
|-------|-------|---------|
| **红色** |关键|预计将产生重大人道主义影响|
| **橙色** |警报 |中等影响，需要监控|
| **绿色** |咨询 |小事件，局部影响 |

### NASA EONET（地球观测站自然事件跟踪器）

通过卫星观测进行近实时自然事件检测：

|类别 |检测方法|典型延迟|
|----------|------------------|---------------|
|猛烈风暴 | GOES/向日葵图像 |分钟 |
|野火| MODIS 热异常 | 4-6 小时 |
|火山 |热能 + SO2 排放 |营业时间 |
|洪水 | SAR 图像 + 仪表 |几小时到几天 |
|海/湖冰 |无源微波|每日 |
|灰尘/雾霾 |气溶胶光学深度|营业时间 |

### 多源重复数据删除

当 GDACS 和 EONET 报告同一事件时：
1. 100公里以内且48小时内的活动视为重复
2. GDACS 严重性优先（人工验证）
3. EONET几何提供更精确的坐标
4. 组合条目显示两个来源属性

### 过滤逻辑

为了防止地图混乱，自然事件被过滤：
- **野火**：仅发生 < 48 小时的事件（较早的火灾已得到控制或众所周知）
- **地震**：全球 M4.5+，人口稠密地区的阈值较低
- **风暴**：仅命名风暴或带有警告的风暴

---

## 军事浪涌检测

该系统使用两种互补的算法来检测异常集中的军事活动。

### 基于基线的浪涌检测

通过将当前飞机数量与指定军事战区内的历史基线进行比较来检测激增：

|参数|价值|目的|
|-----------|-------|---------|
|浪涌阈值| 2.0× 基线 |触发警报的最小乘数 |
|基线窗口| 48小时|用于比较的历史数据|
|最低样品 | 6 观察 |有效基线所需的数据点 |

**跟踪的飞机类别**：

|类别 |示例 |最小计数 |
|----------|----------|---------------|
|运输/空运| C-17、C-130、KC-135、REACH 航班 | 5 架飞机 |
|战斗机| F-15、F-16、F-22、台风 | 4 架飞机 |
|侦察| RC-135、E-3 预警机、U-2 | 3 架飞机 |

### 浪涌严重程度

|严重程度 |标准|意义|
|----------|----------|---------|
| **关键** | 4× 基线或更高 |重大部署|
| **高** | 3× 基线 |显着增加 |
| **中** | 2× 基线 |活动增加 |

### 军事剧院

激增检测将活动分组到战略战区：

|剧院 |中心|关键基地|
|---------|--------|-----------|
|中东 |波斯湾 |乌代德、达夫拉、因吉尔利克 |
|东欧 |波兰 | Ramstein，Spandahlem，瓦斯克 |
|太平洋 |关岛/日本 |安徒生、嘉手纳、横田 |
|非洲之角|吉布提 |莱蒙尼尔营 |

### 异物存在检测

一个单独的系统监视正常操作区域之外的军事操作员：

|操作员|主页 地区 |发现时发出警报 |
|----------|--------------|---------------------|
|美国空军/美国海军 |阿拉斯加防空识别区 |波斯湾、台湾海峡|
|俄罗斯 VKS |加里宁格勒、北极、黑海|波罗的海地区，阿拉斯加防空识别区 |
|中国空军/解放军海军 |台湾海峡、南海| （增加时发出警报）|
|以色列空军 |东方医学|伊朗边境地区|

**警报示例**：
```
FOREIGN MILITARY PRESENCE: Persian Gulf
USAF: 3 aircraft detected (KC-135, RC-135W, E-3)
Severity: HIGH - Operator outside normal home regions
```

### 新闻相关

激增和异物存在警报都会向焦点检测器查询上下文：

1. 确定所涉及的国家（飞机运营商、地区国家）
2. 检查这些国家的联络点
3. 如果存在新闻相关性，请附上标题和证据

**相关性示例**：
```
MILITARY AIRLIFT SURGE: Middle East Theater
Current: 8 transport aircraft (2.5× baseline)
Aircraft: C-17 (3), KC-135 (3), C-130J (2)

NEWS CORRELATION:
Iran: "Iran protests continue amid military..."
→ Iran appears in both news (12) and map signals (9)
```

---

## 战略态势分析

人工智能战略态势面板汇集了指定战区的军用飞机和海军舰艇，提供全球兵力集中情况的一目了然的态势感知。

### 战略战区

九个地理战区受到持续监控，每个战区都有基于典型和平时期活动水平的自定义阈值：

|剧院 |界限 |提高门槛|临界阈值|
|---------|--------|--------------------|--------------------|
| **伊朗剧院** |波斯湾、伊拉克、叙利亚（20°N–42°N，30°E–65°E）| 50 架飞机 | 100 架飞机 |
| **台湾海峡** |台湾、东海（18°N–30°N、115°E–130°E） | 30 架飞机 | 60 架飞机 |
| **朝鲜半岛** |朝鲜/韩国（33°N–43°N，124°E–132°E）| 20 架飞机 | 50 架飞机 |
| **波罗的海剧院** |波罗的海国家、波兰、斯堪的纳维亚半岛（52°N–65°N，10°E–32°E）| 20 架飞机 | 40 架飞机 |
| **黑海** |乌克兰、土耳其、罗马尼亚（40°N–48°N、26°E–42°E）| 15 架飞机 | 30 架飞机 |
| **南海** |菲律宾、越南（5°N–25°N，105°E–121°E）| 25 架飞机 | 50 架飞机 |
| **东地中海** |叙利亚、塞浦路斯、黎巴嫩（33°N–37°N，25°E–37°E）| 15 架飞机 | 30 架飞机 |
| **以色列/加沙** |以色列、加沙地带（北纬 29°–33°、东经 33°–36°）| 10 架飞机 | 25 架飞机 |
| **也门/红海** | Bab el-Mandeb，胡塞武装地区（11°N–22°N，32°E–54°E）| 15 架飞机 | 30 架飞机 |

### 打击能力评估

除了原始计数之外，该系统还评估战区的部队是否构成**进攻性打击包**——持续作战行动所需的资产组合。

**打击能力标准**：
- 空中加油机（KC-135、KC-10、A330 MRTT）
- 机载指挥与控制（E-3 AWACS、E-7 Wedgetail）
- 战斗机（战斗机、攻击机）

每个战区都有反映实际打击包尺寸的自定义阈值：

|剧院 |最小油轮 |最小预警机 |敏战士 |
|---------|-------------|-----------|--------------|
|伊朗剧院| 10 | 10 2 | 30|
|台湾海峡| 5 | 1 | 20 |
|朝鲜半岛| 4 | 1 | 15 | 15
|波罗的海/黑海 | 3-4 | 3-4 1 | 10-15 | 10-15
|以色列/加沙 | 2 | 1 | 8 |

当满足所有三个标准时，战区就会被标记为**打击能力**，表明部队足以进行持续的进攻行动。

### 海军舰艇整合

该面板通过 AIS 跟踪的实时海军舰艇位置来增强飞机数据。船舶分为以下几类：

|类别 |示例 |战略意义 |
|----------|----------|------------------------|
| **运营商** | CVN、CV、LHD |力量投射，空中优势|
| **驱逐舰** | DDG、DDH |防空、巡航导弹打击|
| **护卫舰** | FFG，FF |多角色护航、反潜战 |
| **潜艇** | SSN、SSK、SSBN |威慑、情监侦、打击 |
| **巡逻** |电脑、PG |海防|
| **辅助** | T-AO、AOR |车队支持、物流|

**数据累积注意**：AIS 船舶数据通过 WebSocket 流到达并逐渐累积。面板会在初始装载后 30、60、90 和 120 秒自动重新检查船只计数，以捕获迟到的数据。

### 姿势级别

|水平|指标|标准|意义|
|-------|-----------|----------|---------|
| **正常** | 🟢 规范 |低于升高阈值 |平时的日常活动|
| **提升** | 🟡 电梯 |达到或高于升高的阈值 |增加活动，可能的锻炼|
| **关键** | 🔴暴击 |达到或高于临界阈值 |重大部署，潜在危机|

**升高+可攻击**被视为比常规升高状态更高的警报状态。

### 趋势检测

活动趋势是根据滚动历史数据计算得出的：

- **增加** (↗)：当前活动比上一期高 >10%
- **稳定** (→)：活动在前一时期的 ±10% 范围内
- **减少** (↘)：当前活动比上一期减少 >10%

### 服务器端缓存

战区态势计算在具有 Redis 缓存的边缘服务器上运行：

|缓存类型 | TTL |目的|
|------------|-----|---------|
| **活动缓存** | 5 分钟 |匹配 OpenSky 刷新率 |
| **过时的缓存** | 1小时|上游 API 失败时的回退 |

这可确保所有用户的数据一致，并最大限度地减少对 OpenSky 网络的冗余 API 调用。

---

## 服务器端风险评分API

战略风险和国家不稳定指数 (CII) 分数是在服务器端预先计算的，而不是在浏览器中计算的。这消除了“冷启动”问题，即新用户看不到数据，而系统积累了足够的信息来生成分数。

### 它是如何运作的

`/api/risk-scores` 边缘函数：

1. 从 ACLED 获取最近的抗议/骚乱数据（7 天窗口）
2. 计算 20 个一级国家的 CII 分数
3. 从加权前 5 名 CII 分数得出战略风险
4. 在 Redis 中缓存结果（10 分钟 TTL）

### CII 分数计算

每个国家的得分综合为：

**基线风险**（0-50 分）：基于历史不稳定、持续冲突和独裁治理的静态地缘政治风险。

|国家 |基线|理由|
|---------|----------|-----------|
|叙利亚、乌克兰、也门 | 50 | 50活跃的冲突地区|
|缅甸、委内瑞拉、朝鲜 | 40-45 | 40-45内乱，独裁|
|伊朗、以色列、巴基斯坦 | 35-45 | 35-45地区紧张局势|
|沙特阿拉伯、土耳其、印度 | 20-25 | 20-25中度不稳定|
|德国、英国、美国 | 5-10 |稳定的民主国家|

**骚乱成分**（0-50 分）：最近的抗议和骚乱活动，按事件重要性乘数加权。

**信息成分**（0-25 分）：新闻报道强度（代表国际关注度）。

**安全部分**（0-25 分）：基线加上防暴贡献。

### 事件重要性乘数

一些国家发生的事件比其他国家更具全球意义：

|乘数|国家 |理由|
|------------|-----------|-----------|
| 3.0× |朝鲜 |任何明显的骚乱都是极不寻常的|
| 2.0-2.5× |中国、俄罗斯、伊朗、沙特阿拉伯 |独裁国家镇压抗议|
| 1.5-1.8×|台湾、巴基斯坦、缅甸、委内瑞拉 |地区热点|
| 0.5-0.8×|美国、英国、法国、德国 |抗议活动在民主国家已是家常便饭 |

### 战略风险推导

综合战略风险评分按前 5 个 CII 评分的加权平均值计算：

```
Weights: [1.0, 0.85, 0.70, 0.55, 0.40] (total: 3.5)
Strategic Risk = (Σ CII[i] × weight[i]) / 3.5 × 0.7 + 15
```

排名靠前的国家贡献最大，排名较低的国家的影响力逐渐减弱。

### 后备行为

当 ACLED 数据不可用时（API 错误、速率限制、授权过期）：

1. **陈旧缓存**（1 小时 TTL）：使用 `stale: true` 标志返回最近的分数
2. **基线回退**：仅使用带有 `baseline: true` 标志的静态基线值返回分数

这确保了仪表板即使在上游中断期间也始终显示有意义的数据。

---

## 服务状态监控

服务状态面板跟踪 WorldMonitor 用户可能依赖的外部服务的运行状况。

### 受监控的服务

|服务 |状态端点|解析器|
|---------|-----------------|--------|
|人择（克劳德）|克劳德.com |状态页.io |
|开放人工智能 |状态.openai.com |状态页.io |
|韦尔塞尔 | vercel-status.com |状态页.io |
|云耀 | cloudflarestatus.com |状态页.io |
|亚马逊AWS | health.aws.amazon.com |定制|
| GitHub | githubstatus.com |状态页.io |

### 状态级别

|状态 |颜色 |意义|
|--------|-------|---------|
| **运营** |绿色|所有系统运行正常|
| **降级** |黄色|部分中断或性能问题 |
| **部分停电** |橙色|某些组件不可用 |
| **重大停电** |红色|严重的服务中断 |

### 为什么这很重要

外部服务中断可能会影响：
- AI 总结（Groq、OpenRouter 中断）
- 部署管道（Vercel、GitHub 中断）
- API 可用性（Cloudflare、AWS 中断）

当仪表板功能出现异常时，监视这些服务可以提供上下文。

---

## 刷新间隔

根据波动性和 API 限制，不同的数据源以不同的频率更新。

### 投票时间表

|数据类型|间隔|理由|
|-----------|----------|-----------|
| **新闻提要** | 5 分钟 |平衡新鲜度与速率限制 |
| **股票报价** | 1 分钟 |市场交易时间需要近乎实时|
| **加密货币价格** | 1 分钟 | 24/7 市场，高波动性 |
| **预测** | 5 分钟 |概率变化缓慢|
| **地震** | 5 分钟 | USGS 每 5 分钟更新一次 |
| **天气警报** | 10 分钟 | NWS 警报频率 |
| **航班延误** | 10 分钟 | FAA 状态更新节奏 |
| **网络中断** | 60 分钟 | BGP 事件很少见 |
| **经济数据** | 30 分钟 | FRED 数据盘中很少变化 |
| **军事追踪** | 5 分钟 |活动模式需要及时更新|
| **PizzINT** | 10 分钟 |客流量变化缓慢|

### 实时流

AIS 船舶跟踪使用 WebSocket 实现真正的实时：

- **连接**：持久 WebSocket 到铁路中继
- **消息**：船舶传输时位置更新
- **重新连接**：自动带指数退避（5s → 10s → 20s）

### 用户控制

时间范围选择器影响显示的数据，而不是获取频率：

|选择|效果|
|-----------|--------|
| **1 小时** |仅显示过去 60 分钟的事件 |
| **6 小时** |显示过去 6 小时的活动 |
| **24 小时** |显示昨天的活动 |
| **7 天** |显示所有最近的事件 |

历史过滤是在客户端进行的——所有数据都会被获取，但会被过滤以供显示。

---

## 技术堆栈

|层 |技术 |目的|
|-------|------------|---------|
| **语言** | TypeScript 5.x | 60 多个源文件的类型安全 |
| **构建** |维特 |快速 HMR、优化生产构建 |
| **地图（桌面）** |甲板.gl + MapLibre GL |大型数据集的 WebGL 加速渲染 |
| **地图（手机）** | D3.js + TopoJSON | SVG 电池效率后备方案 |
| **并发** |网络工作者|非主线程聚类和关联|
| **人工智能/机器学习** | ONNX 运行时网络 |基于浏览器的离线摘要推理 |
| **网络** | WebSocket + REST |实时AIS流，其他API的HTTP |
| **存储** |索引数据库 |快照、基线（兆字节状态）|
| **偏好设置** |本地存储|用户设置、显示器、面板顺序 |
| **部署** |维塞尔边缘 |全球分布的无服务器代理 |

### 地图渲染架构

该地图使用针对每个平台优化的混合渲染策略：

**桌面（deck.gl + MapLibre GL）**：
- WebGL 加速层可顺利处理数千个标记
- MapLibre GL 提供底图图块 (OpenStreetMap)
- 适用于不同数据类型的 GeoJSON、散点图、路径和图标层
- 基于 GPU 的聚类和拣选，实现响应式交互

**移动（D3.js + TopoJSON）**：
- SVG 渲染可提高电池效率
- 减少标记数量并简化图层
- 与较大命中目标的触摸优化交互
- WebGL 不可用时自动回退

### 关键库

- **deck.gl**：高性能 WebGL 可视化层
- **MapLibre GL**：开源地图渲染引擎
- **D3.js**：SVG 地图渲染、缩放行为（移动回退）
- **TopoJSON**：高效的地理数据编码
- **ONNX 运行时**：基于浏览器的机器学习推理
- **自定义 HTML 转义**：XSS 预防（DOMPurify 模式）

### 无外部 UI 框架

整个 UI 都是手工制作的 DOM 操作——没有 React、Vue 或 Angular。这使得捆绑包很小（gzip 压缩后约 250KB），并提供对渲染性能的细粒度控制。

### 构建时配置

Vite 在构建时注入配置值，从而实现自动版本同步等功能：

|变量|来源 |目的|
|----------|--------|---------|
| `__APP_VERSION__` | `package.json` 版本字段 |标题显示当前版本 |

这可确保显示的版本始终与已发布的包匹配，无需手动同步。

```typescript
// vite.config.ts
define: {
  __APP_VERSION__: JSON.stringify(pkg.version),
}

// App.ts
const header = `World Monitor v${__APP_VERSION__}`;
```

---

## Installation

```bash
# Clone the repository
git clone https://github.com/koala73/worldmonitor.git
cd worldmonitor

# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build
```

## API 依赖关系

仪表板从各种公共 API 和数据源获取数据：

|服务 |数据|需要身份验证 |
|---------|------|---------------|
| RSS2JSON |新闻提要解析|没有 |
|芬兰枢纽 |股票报价（主要）|是（免费）|
|雅虎财经 |股票指数和商品（备份）|没有 |
| CoinGecko |加密货币价格 |没有 |
|美国地质勘探局|地震数据|没有 |
|美国宇航局 EONET |自然事件（风暴、火灾、火山、洪水）|没有 |
|新创建|天气警报 |没有 |
|弗雷德 |经济指标（美联储数据）|没有 |
|环评|石油分析（价格、产量、库存）|是（免费）|
|美国支出网 | USASpending.gov联邦政府合同和奖项 |没有 |
|综合市场 |预测市场|没有 |
| ACLED |武装冲突和抗议数据|是（免费）|
| GDELT 地理 |新闻衍生事件地理定位+紧张局势|没有 |
| GDELT 文档 |基于主题的情报源（网络、军事、核）|没有 |
|美国联邦航空局 (FAA) NAS 状态 |机场延误状况 |没有 |
| Cloudflare 雷达 |网络中断数据|是（免费）|
| AISStream |活船位置 |是（继电器）|
|开放天空网络|军用飞机追踪|是（免费）|
|翼钻 |飞机浓缩（所有者、运营商）|是（免费）|
|皮兹INT |五角大楼区域活动指标|没有 |

### 可选 API 密钥

某些功能需要 API 凭据。没有它们，相应的层将被隐藏：

|变量|服务 |如何获取 |
|----------|---------|------------|
| `FINNHUB_API_KEY` |股票报价（主要）|免费注册[finnhub.io](https://finnhub.io/) |
| `EIA_API_KEY` |石油分析|免费注册[eia.gov/opendata](https://www.eia.gov/opendata/) |
| `VITE_WS_RELAY_URL` | AIS 船舶追踪 |部署 AIS 中继或使用托管服务 |
| `VITE_OPENSKY_RELAY_URL` |军用飞机|使用 OpenSky 凭证部署中继 |
| `OPENSKY_CLIENT_ID` | OpenSky 身份验证（中继）|免费注册[opensky-network.org](https://opensky-network.org) |
| `OPENSKY_CLIENT_SECRET` | OpenSky 身份验证（中继）| OpenSky 帐户设置中的 API 密钥 |
| `CLOUDFLARE_API_TOKEN` |互联网中断 |具有 Radar 访问权限的免费 Cloudflare 帐户 |
| `ACLED_ACCESS_TOKEN` |抗议数据（服务器端）|在 acleddata.com 免费注册 |
| `WINGBITS_API_KEY` |飞机浓缩|联系 [Wingbits](https://wingbits.com) 获取 API 访问权限 |

仪表板无需这些键即可完全运行 - 受影响的层根本不会出现。核心功能（新闻、市场、地震、天气）无需配置。

## 项目结构

```
src/
├── App.ts                    # Main application orchestrator
├── main.ts                   # Entry point
├── components/
│   ├── DeckGLMap.ts          # WebGL map with deck.gl + MapLibre (desktop)
│   ├── Map.ts                # D3.js SVG map (mobile fallback)
│   ├── MapContainer.ts       # Map wrapper with platform detection
│   ├── MapPopup.ts           # Contextual info popups
│   ├── SearchModal.ts        # Universal search (⌘K)
│   ├── SignalModal.ts        # Signal intelligence display with focal points
│   ├── PizzIntIndicator.ts   # Pentagon Pizza Index display
│   ├── VirtualList.ts        # Virtual/windowed scrolling
│   ├── InsightsPanel.ts      # AI briefings + focal point display
│   ├── EconomicPanel.ts      # FRED economic indicators
│   ├── GdeltIntelPanel.ts    # Topic-based intelligence (cyber, military, etc.)
│   ├── LiveNewsPanel.ts      # YouTube live news streams with channel switching
│   ├── NewsPanel.ts          # News feed with clustering
│   ├── MarketPanel.ts        # Stock/commodity display
│   ├── MonitorPanel.ts       # Custom keyword monitors
│   ├── CIIPanel.ts           # Country Instability Index display
│   ├── CascadePanel.ts       # Infrastructure cascade analysis
│   ├── StrategicRiskPanel.ts # Strategic risk overview dashboard
│   ├── StrategicPosturePanel.ts # AI strategic posture with theater analysis
│   ├── ServiceStatusPanel.ts # External service health monitoring
│   └── ...
├── config/
│   ├── feeds.ts              # 70+ RSS feeds, source tiers, regional sources
│   ├── geo.ts                # 30+ hotspots, conflicts, 55 cables, waterways, spaceports, minerals
│   ├── pipelines.ts          # 88 oil & gas pipelines
│   ├── ports.ts              # 61 strategic ports worldwide
│   ├── bases-expanded.ts     # 220+ military bases
│   ├── ai-datacenters.ts     # 313 AI clusters (filtered to 111)
│   ├── airports.ts           # 30 monitored US airports
│   ├── irradiators.ts        # IAEA gamma irradiator sites
│   ├── nuclear-facilities.ts # Global nuclear infrastructure
│   ├── markets.ts            # Stock symbols, sectors
│   ├── entities.ts           # 100+ entity definitions (companies, indices, commodities, countries)
│   └── panels.ts             # Panel configs, layer defaults, mobile optimizations
├── services/
│   ├── ais.ts                # WebSocket vessel tracking with density analysis
│   ├── military-vessels.ts   # Naval vessel identification and tracking
│   ├── military-flights.ts   # Aircraft tracking via OpenSky relay
│   ├── military-surge.ts     # Surge detection with news correlation
│   ├── cached-theater-posture.ts # Theater posture API client with caching
│   ├── wingbits.ts           # Aircraft enrichment (owner, operator, type)
│   ├── pizzint.ts            # Pentagon Pizza Index + GDELT tensions
│   ├── protests.ts           # ACLED + GDELT integration
│   ├── gdelt-intel.ts        # GDELT Doc API topic intelligence
│   ├── gdacs.ts              # UN GDACS disaster alerts
│   ├── eonet.ts              # NASA EONET natural events + GDACS merge
│   ├── flights.ts            # FAA delay parsing
│   ├── outages.ts            # Cloudflare Radar integration
│   ├── rss.ts                # RSS parsing with circuit breakers
│   ├── markets.ts            # Finnhub, Yahoo Finance, CoinGecko
│   ├── earthquakes.ts        # USGS integration
│   ├── weather.ts            # NWS alerts
│   ├── fred.ts               # Federal Reserve data
│   ├── oil-analytics.ts      # EIA oil prices, production, inventory
│   ├── usa-spending.ts       # USASpending.gov contracts & awards
│   ├── polymarket.ts         # Prediction markets (filtered)
│   ├── clustering.ts         # Jaccard similarity clustering
│   ├── correlation.ts        # Signal detection engine
│   ├── velocity.ts           # Velocity & sentiment analysis
│   ├── related-assets.ts     # Infrastructure near news events
│   ├── activity-tracker.ts   # New item detection & highlighting
│   ├── analysis-worker.ts    # Web Worker manager
│   ├── ml-worker.ts          # Browser ML inference (ONNX)
│   ├── summarization.ts      # AI briefings with fallback chain
│   ├── parallel-analysis.ts  # Concurrent headline analysis
│   ├── storage.ts            # IndexedDB snapshots & baselines
│   ├── data-freshness.ts     # Real-time data staleness tracking
│   ├── signal-aggregator.ts  # Central signal collection & grouping
│   ├── focal-point-detector.ts   # Intelligence synthesis layer
│   ├── entity-index.ts       # Entity lookup maps (by alias, keyword, sector)
│   ├── entity-extraction.ts  # News-to-entity matching for market correlation
│   ├── country-instability.ts    # CII scoring algorithm
│   ├── geo-convergence.ts        # Geographic convergence detection
│   ├── infrastructure-cascade.ts # Dependency graph and cascade analysis
│   └── cross-module-integration.ts # Unified alerts and strategic risk
├── workers/
│   └── analysis.worker.ts    # Off-thread clustering & correlation
├── utils/
│   ├── circuit-breaker.ts    # Fault tolerance pattern
│   ├── sanitize.ts           # XSS prevention (escapeHtml, sanitizeUrl)
│   ├── urlState.ts           # Shareable link encoding/decoding
│   └── analysis-constants.ts # Shared thresholds for worker sync
├── styles/
└── types/
api/                          # Vercel Edge serverless proxies
├── cloudflare-outages.js     # Proxies Cloudflare Radar
├── coingecko.js              # Crypto prices with validation
├── eia/[[...path]].js        # EIA petroleum data (oil prices, production)
├── faa-status.js             # FAA ground stops/delays
├── finnhub.js                # Stock quotes (batch, primary)
├── fred-data.js              # Federal Reserve economic data
├── gdelt-doc.js              # GDELT Doc API (topic intelligence)
├── gdelt-geo.js              # GDELT Geo API (event geolocation)
├── polymarket.js             # Prediction markets with validation
├── yahoo-finance.js          # Stock indices/commodities (backup)
├── opensky-relay.js          # Military aircraft tracking
├── wingbits.js               # Aircraft enrichment proxy
├── risk-scores.js            # Pre-computed CII and strategic risk (Redis cached)
├── theater-posture.js        # Theater-level force aggregation (Redis cached)
├── groq-summarize.js         # AI summarization with Groq API
└── openrouter-summarize.js   # AI summarization fallback via OpenRouter
```

## Usage

### 键盘快捷键
- `⌘K` / `Ctrl+K` - 打开搜索
- `↑↓` - 导航搜索结果
- `Enter` - 选择结果
- `Esc` - 关闭模态

### 地图控制
- **滚动** - 放大/缩小
- **拖动** - 平移地图
- **点击标记** - 显示带有完整上下文的详细弹出窗口
- **悬停标记** - 显示带有摘要信息的工具提示
- **层切换** - 显示/隐藏数据层

### 地图标记设计

基础设施标记（核设施、经济中心、港口）不带标签显示，以减少视觉混乱。完整信息可通过互动获得：

|层 |标签行为 |互动|
|-------|---------------|-------------|
|核设施|隐藏|点击查看包含详细信息的弹出窗口 |
|经济中心|隐藏|点击查看包含详细信息的弹出窗口 |
|抗议|隐藏|将鼠标悬停在工具提示上，单击查看详细信息 |
|军事基地|隐藏|单击以获取包含基本信息的弹出窗口 |
|热点|可见|颜色编码的活动水平 |
|冲突|可见|现状及相关方 |

这种设计优先考虑地理意识而不是标签密度——用户可以快速扫描标记，然后进行交互以获得上下文。

### 面板管理
- **拖动面板** - 重新排序布局
- **设置 (⚙)** - 切换面板可见性

### 可共享链接

当前视图状态编码在 URL 中，从而能够：
- **书签**：保存特定视图以便快速访问
- **共享**：向同事发送指向您的确切地图位置和图层配置的链接
- **深层链接**：直接链接到特定区域或功能

**编码参数**：
|参数|描述 |
|-----------|-------------|
| `lat`、`lon` |地图中心坐标|
| `zoom` |缩放级别（1-10）|
| `time` |活动时间过滤器（1小时、6小时、24小时、7天）|
| `view` |预设视图（全球、美国、中东）|
| `layers` |以逗号分隔的启用层 ID |

示例：`?lat=38.9&lon=-77&zoom=6&layers=bases,conflicts,hotspots`

值经过验证和限制以防止无效状态。

## 数据源

### 新闻源
聚合来自主要新闻媒体、政府来源和专业出版物的 **70 多个 RSS 源**，并按源层优先顺序排列。类别包括世界新闻、中东和北非、非洲、拉丁美洲、亚太地区、能源、技术、人工智能/机器学习、金融、政府发布、国防/英特尔、智囊团和国际危机组织。

### 地理空间数据
- **热点**：30多个具有关键词相关性的全球情报热点（包括萨赫勒、海地、非洲之角）
- **冲突**：10多个与相关方发生冲突的地区
- **军事基地**：来自美国、北约、俄罗斯、中国和盟国的 220 多个基地
- **管道**：遍布各大洲的 88 条正在运营的石油/天然气管道
- **海底电缆**：55 条主要海底电缆路线
- **核**：100 多个发电厂、武器实验室、浓缩设施
- **人工智能基础设施**：111 个主要计算集群（≥10k GPU）
- **战略水道**：8 个关键阻塞点
- **港口**：61 个战略港口（集装箱、石油/液化天然气、海军、咽喉要道）

### 实时 API
- **USGS**：地震源（M4.5+ 全球）
- **NASA EONET**：自然事件（风暴、野火、火山、洪水）
- **NWS**：恶劣天气警报（美国）
- **FAA**：机场延误和地面停靠
- **Cloudflare Radar**：互联网中断检测
- **AIS**：实时船舶位置
- **ACLED/GDELT**：抗议和骚乱事件
- **雅虎财经**：股票报价和指数
- **CoinGecko**：加密货币价格
- **FRED**：美联储经济数据
- **Polymarket**：预测市场赔率

## 数据归属

该项目使用以下来源的数据。请尊重他们的使用条款。

### 飞机追踪
数据由 [The OpenSky Network](https://opensky-network.org) 提供。如果您在出版物中使用此数据，请引用：

> 马蒂亚斯·谢弗、马丁·斯特罗迈尔、文森特·伦德斯、伊万·马丁诺维奇和马蒂亚斯·威廉。 “提出 OpenSky：用于研究的大规模 ADS-B 传感器网络”。摘自*第 13 届 IEEE/ACM 国际传感器网络信息处理研讨会论文集 (IPSN)*，第 83-94 页，2014 年 4 月。

### 冲突和抗议数据
- **ACLED**：武装冲突地点和事件数据。来源：[ACLED](https://acleddata.com)。数据必须根据其 [Attribution Policy](https://acleddata.com/attributionpolicy/) 进行归属。
- **GDELT**：全球事件、语言和语气数据库。来源：[The GDELT Project](https://www.gdeltproject.org/)。

### 财务数据
- **股票行情**：由 [Finnhub](https://finnhub.io/)（主要）提供支持，并以 [Yahoo Finance](https://finance.yahoo.com/) 作为指数和商品的备份
- **加密货币**：由 [CoinGecko API](https://www.coingecko.com/en/api) 提供支持
- **经济指标**：数据来自[FRED](https://fred.stlouisfed.org/)，圣路易斯联邦储备银行

### 地球物理数据
- **地震**：[U.S. Geological Survey](https://earthquake.usgs.gov/)，ANSS 综合目录
- **自然事件**：[NASA EONET](https://eonet.gsfc.nasa.gov/) - 地球观测站自然事件跟踪器（风暴、野火、火山、洪水）
- **天气警报**：[National Weather Service](https://www.weather.gov/) - 开放数据，免费使用

### 基础设施和交通
- **机场延误**：[FAA Air Traffic Control System Command Center](https://www.fly.faa.gov/)
- **船舶跟踪**：[AISstream](https://aisstream.io/) 实时 AIS 数据
- **互联网中断**：[Cloudflare Radar](https://radar.cloudflare.com/) (CC BY-NC 4.0)

### 其他来源
- **预测市场**：[Polymarket](https://polymarket.com/)

## 致谢

原始仪表板概念的灵感来自 Reggie James ([@HipCityReg](https://x.com/HipCityReg/status/2009003048044220622)) - 感谢您对综合态势感知工具的愿景

特别感谢 [Wingbits](https://wingbits.com)** 的 **Yanal 为飞机浓缩数据提供 API 访问，从而实现军用飞机分类和所有权跟踪

感谢 **[@fai9al](https://github.com/fai9al)** 的灵感和原创公关，促成了 Tech Monitor 变体

---

## 限制和注意事项

该项目是一个**概念验证**，展示了公开数据的可能性。虽然功能强大，但也有一些重要的限制：

### 数据完整性

某些数据源需要付费帐户才能完全访问：
- **ACLED**：免费套餐有 API 限制；程序化访问所需的研究层
- **OpenSky 网络**：速率限制；商业级别提供更高的配额
- **卫星AIS**：全球覆盖需要商业提供商（Spire、Kpler 等）

该仪表板适用于免费套餐，但覆盖范围或更新频率可能存在差距。

### AIS 覆盖偏差

船舶层通过 [AISStream.io](https://aisstream.io) 使用地面 AIS 接收器。这造成了**地理偏见**：
- **强覆盖**：欧洲水域、大西洋、主要港口
- **覆盖范围较弱**：中东、公海、偏远地区

地面接收器仅检测距海岸约 50 公里范围内的船只。卫星 AIS（商业）提供真正的全球覆盖，但不包含在此免费实施中。

### 被阻止的数据源

一些发布商阻止来自云提供商（Vercel、Railway、AWS）的请求：
- 某些渠道的 RSS 提要可能会失败并出现 403 错误
- 这是常见的反机器人措施，而不是仪表板中的错误
- 受影响的源会通过断路器自动禁用

系统会正常降级——被阻止的源会被跳过，而其他源则继续运行。

---

## 路线图

有关详细规划，请参阅 [ROADMAP.md](ROADMAP.md)。最近的情报增强：

### Completed

- ✅ **焦点检测** - 将新闻实体与地图信号相关联的情报合成
- ✅ **AI 支持的简报** - Groq/OpenRouter/Browser ML 后备链进行摘要
- ✅ **军事激增检测** - 当多个操作员聚集在区域时发出警报
- ✅ **新闻信号相关性** - 浪涌警报包括相关的焦点上下文
- ✅ **GDACS 集成** - 联合国地震、洪水、飓风、火山灾害警报系统
- ✅ **WebGL 地图 (deck.gl)** - 为桌面用户提供高性能渲染
- ✅ **浏览器 ML 回退** - ONNX 运行时用于离线汇总功能
- ✅ **多信号地理汇聚** - 当 3 个以上数据类型在 24 小时内汇聚到同一区域时发出警报
- ✅ **国家不稳定指数 (CII)** - 20 个一级国家的实时综合风险评分
- ✅ **基础设施级联可视化** - 显示中断的下游影响的依赖关系图
- ✅ **战略风险概述** - 具有跨模块关联和重复数据删除功能的统一警报系统
- ✅ **GDELT 主题情报** - 军事、网络、核和制裁主题的分类源
- ✅ **OpenSky 身份验证** - 通过中继跟踪军用飞机的 OAuth2 凭据
- ✅ **人类可读位置** - 聚合警报显示地名而不是坐标
- ✅ **数据新鲜度跟踪** - 状态面板显示所有源的启用/禁用状态
- ✅ **CII 评分偏差预防** - 日志缩放和冲突区域下限可防止新闻量偏差
- ✅ **警报预热期** - 抑制仪表板启动时的误报
- ✅ **重大抗议过滤** - 地图仅显示骚乱和高度严重的抗议活动
- ✅ **情报调查结果详细模式** - 单击任何警报以获取完整的上下文和组件细分
- ✅ **构建时版本同步** - 标头版本与 package.json 自动同步
- ✅ **技术监控变体** - 专用技术部门仪表板，包含初创生态系统、云区域和技术事件
- ✅ **智能标记聚类** - 通过点击展开弹出窗口对附近标记进行地理分组
- ✅ **变体切换器 UI** - World Monitor 和 Tech Monitor 之间的紧凑轨道导航
- ✅ **CII 学习模式** - 15 分钟校准期，带有视觉进度指示器
- ✅ **区域技术覆盖** - 经验证的中东和北非、欧洲、亚太中心的技术总部数据
- ✅ **服务状态面板** - 外部服务健康监控（AI提供商、云平台）
- ✅ **人工智能战略态势小组** - 战区级部队聚合与打击能力评估
- ✅ **服务器端风险评分 API** - 使用 Redis 缓存预先计算 CII 和战略风险评分
- ✅ **海军舰艇分类** - 已知舰艇数据库，具有船体号码匹配和 AIS 类型推断
- ✅ **打击能力检测** - 进攻部队评估（加油机+预警机+战斗机）
- ✅ **战区态势阈值** - 为每个战略战区定制升高/关键阈值

### 计划中

**高优先级：**
- **时间异常检测** - 标记一天/一周/一年中不同时间的异常活动（例如，“周二的军事航班是正常情况的 3 倍”）
- **贸易航线风险评分** - 主要航线的实时供应链脆弱性（亚洲→欧洲、中东→欧洲等）

**中优先级：**
- **历史回放** - 通过时间线清理查看过去的仪表板状态
- **选举日历集成** - 在重大选举前 30 天自动提高敏感度
- **Choropleth CII 地图图层** - 显示不稳定分数的国家/地区颜色叠加

**未来的增强功能：**
- **警报 Webhooks** - 将关键警报推送到 Slack、Discord、电子邮件
- **自定义国家/地区监视列表** - 用户定义的二级国家/地区监控
- **其他数据源** - 世界银行、国际货币基金组织、OFAC 制裁、联合国难民署难民数据、粮农组织粮食安全
- **智库提要** - RUSI、查塔姆研究所、ECFR、CFR、威尔逊中心、CNAS、军备控制协会

完整的 [ROADMAP.md](ROADMAP.md) 记录了实现细节、API 端点和 30 多个免费数据源以供将来集成。

---

## 设计理念

**信息密度高于美观。**每个像素都应该传达信号。深色界面可最大限度地减少长时间监控过程中的眼睛疲劳。面板可折叠、可拖动和可隐藏——可自定义以仅显示重要内容。

**权威很重要。** 并非所有来源都是平等的。有线服务和官方政府渠道优先于聚合商和博客。当多个来源报道同一个故事时，最权威的来源将显示为主要来源。

**积累的相关性。**原始新闻源是噪音。其价值在于对相关故事进行聚类、检测速度变化以及识别跨源模式。单个“Broadcom +2.5% 由 AI 芯片新闻解释”信号比单独显示两个数据点更有价值。

**信号，而非噪音。** 重复数据删除具有积极性。相同的市场走势不会产生重复的警报。信号包括置信度分数，以便您可以优先考虑注意力。警觉疲劳是态势感知的敌人。

**知识优先匹配。** 简单的关键字匹配会产生误报。实体知识库了解到 AVGO 是 Broadcom，Broadcom 与 Nvidia 竞争，而且两者都在半导体领域。该语义层将朴素的字符串匹配转变为智能关联。

**优雅地失败。**外部 API 不可靠。断路器可防止级联故障。中断期间会显示缓存的数据。状态面板准确显示哪些内容正在工作，哪些内容不工作——没有无声的故障。

**本地优先。** 没有帐户，没有云同步。所有首选项和历史记录都存储在本地。唯一的网络流量是获取公共数据。您的监控配置由您个人决定。

**在重要的地方进行计算。** CPU 密集型操作（集群、关联）在 Web Workers 中运行，以保持 UI 响应。主线程仅处理渲染和用户交互。

---

## 系统架构

### 数据流概述

```
                                    ┌─────────────────────────────────┐
                                    │     External Data Sources       │
                                    │  RSS Feeds, APIs, WebSockets    │
                                    └─────────────┬───────────────────┘
                                                  │
                         ┌────────────────────────┼────────────────────────┐
                         │                        │                        │
                         ▼                        ▼                        ▼
               ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
               │   RSS Parser    │    │    API Client   │    │  WebSocket Hub  │
               │  (News Feeds)   │    │ (USGS, FAA...)  │    │ (AIS, Markets)  │
               └────────┬────────┘    └────────┬────────┘    └────────┬────────┘
                        │                      │                      │
                        └──────────────────────┼──────────────────────┘
                                               │
                                               ▼
                             ┌─────────────────────────────────┐
                             │      Circuit Breakers           │
                             │  (Rate Limiting, Retry Logic)   │
                             └─────────────┬───────────────────┘
                                           │
                         ┌─────────────────┼─────────────────┐
                         │                 │                 │
                         ▼                 ▼                 ▼
               ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
               │  Data Freshness │ │  Search Index   │ │   Web Worker    │
               │    Tracker      │ │  (Searchables)  │ │  (Clustering)   │
               └────────┬────────┘ └────────┬────────┘ └────────┬────────┘
                        │                   │                   │
                        └───────────────────┼───────────────────┘
                                            │
                                            ▼
                             ┌─────────────────────────────────┐
                             │         App State               │
                             │  (Map, Panels, Intelligence)    │
                             └─────────────┬───────────────────┘
                                           │
                                           ▼
                             ┌─────────────────────────────────┐
                             │      Rendering Pipeline         │
                             │  D3.js Map + React-like Panels  │
                             └─────────────────────────────────┘
```

### 更新周期

根据波动性和 API 限制，不同的数据类型以不同的时间间隔刷新：

|数据类型|刷新间隔|理由|
|-----------|------------------|-----------|
| **新闻提要** | 3 分钟 |新鲜度与 API 礼貌之间的平衡 |
| **市场数据** | 60 秒 |具有速率限制约束的实时感知 |
| **军事追踪** | 30 秒 |态势感知的高优先级 |
| **天气警报** | 5 分钟 | NWS 更新频率 |
| **地震** | 5 分钟 |美国地质调查局更新节奏 |
| **互联网中断** | 5 分钟 | Cloudflare Radar 更新频率 |
| **AIS 船舶** |实时 | WebSocket 流 |

### 错误处理策略

系统对外部服务故障实现深度防御：

**断路器**
- 每个外部服务都有独立的断路器
- 连续3次失败后，电路断开60秒
- 部分故障不会级联到其他服务
- 状态面板显示确切的故障状态

**优雅的降级**
- 停电期间显示陈旧的缓存数据（带有时间戳警告）
- 失败的服务将在下一个周期自动重试
- 关键数据（新闻、市场）有备份源

**用户反馈**
- 标题中的实时状态指示器
- 状态面板中的特定错误消息
- 没有静默故障——每个数据源状态都是可见的

### 构建时优化

该项目使用 Vite 来实现最佳生产构建：

**代码分割**
- Web Worker 代码单独捆绑
- 配置文件（tech-geo.ts、pipelines.ts）经过tree-shaken
- 延迟加载面板减少了初始包大小

**变体构建**
- `npm run build` - 标准地缘政治仪表板
- `npm run build:tech` - 具有不同默认值的技术部门变体
- 两者共享相同的代码库，通过环境变量配置

**资产优化**
- TopoJSON地理数据被预压缩
- 静态配置数据在构建时内联
- CSS 被缩小并自动添加前缀

### 安全考虑

**客户端安全**
- 所有用户输入在渲染之前都会通过 `escapeHtml()` 进行清理
- URL 在 href 分配之前通过 `sanitizeUrl()` 进行验证
- 没有 `innerHTML` 且用户可控制内容

**API安全**
- 敏感 API 密钥仅存储在服务器端
- 代理函数验证和清理参数
- 地理坐标被限制在有效范围内

**隐私**
- 没有用户帐户或云存储
- 所有首选项都存储在 localStorage 中
- 除了基本 Vercel 分析之外没有遥测（仅限页面浏览量）

---

## 贡献

欢迎贡献！无论您是修复错误、添加功能、改进文档还是提出想法，您的帮助都会使这个项目变得更好。

### Getting Started

1. **在 GitHub 上分叉存储库**
2. **在本地克隆您的分叉**：
   ```bash
   git clone https://github.com/YOUR_USERNAME/worldmonitor.git
   cd worldmonitor
   ```
3. **安装依赖**：
   ```bash
   npm install
   ```
4. **创建功能分支**：
   ```bash
   git checkout -b feature/your-feature-name
   ```
5. **启动开发服务器**：
   ```bash
   npm run dev
   ```

### 代码风格和约定

该项目遵循特定模式来保持一致性：

**打字稿**
- 启用严格类型检查 - 尽可能避免 `any`
- 使用接口作为数据结构，使用类型作为联合
- 优先使用 `const` 而不是 `let`，切勿使用 `var`

**建筑学**
- 服务 (`src/services/`) 处理数据获取和业务逻辑
- 组件 (`src/components/`) 处理 UI 渲染
- 配置（`src/config/`）包含静态数据和常量
- Utils (`src/utils/`) 包含共享辅助函数

**安全**
- 渲染用户控制或外部数据时始终使用 `escapeHtml()`
- 对来自外部源的任何 URL 使用 `sanitizeUrl()`
- 验证和限制 API 代理端点中的参数

**表现**
- 昂贵的计算应该在 Web Worker 中运行
- 对包含 50 多个项目的列表使用虚拟滚动
- 为外部API调用实现断路器

**无评论政策**
- 代码应该通过清晰的命名来自我记录
- 只为不明显的算法或解决方法添加注释
- 永远不要提交注释掉的代码

### 提交拉取请求

1. **确保您的代码能够构建**：
   ```bash
   npm run build
   ```

2. **在浏览器中手动测试您的更改**

3. **写一个明确的提交消息**：
   ```
   Add earthquake magnitude filtering to map layer

   - Adds slider control to filter by minimum magnitude
   - Persists preference to localStorage
   - Updates URL state for shareable links
   ```

4. **推送到你的叉子**：
   ```bash
   git push origin feature/your-feature-name
   ```

5. **打开拉取请求**：
- 描述变更的清晰标题
- 描述 PR 的作用及其原因
- UI更改的屏幕截图
- 任何重大更改或迁移说明

### 怎样才是好的公关

|做|不要|
|----|-------|
|专注于一项功能或修复 |捆绑不相关的更改 |
|遵循现有的代码模式 |无需讨论就引入新框架 |
|保持最小化和有针对性的改变 |不必要地重构周围的代码 |
|如果添加功能，请更新自述文件 |无需文档即可添加功能 |
|测试边缘情况 |仅假设快乐路径 |

### 贡献类型

**🐛错误修复**
- 发现东西坏了？修复它并提交 PR
- 在 PR 描述中包含重现步骤

**✨ 新功能**
- 新的数据层（具有公共 API 源）
- 用户界面/用户体验改进
- 性能优化
- 新的信号检测算法

**📊数据来源**
- 用于新闻聚合的附加 RSS 提要
- 新的地理空间数据集（基地、基础设施等）
- 现有数据的替代 API

**📝 文档**
- 澄清现有文档
- 添加示例和用例
- 修复拼写错误并提高可读性

**🔒安全**
- 通过 GitHub Issues（非关键）或电子邮件（关键）报告漏洞
- XSS 预防改进
- 输入验证增强功能

### 审核流程

1. **自动检查** 在 PR 提交时运行
2. **几天内维护者审查**
3. **通过提交到同一分支解决反馈**
4. **合并** 一旦获得批准

不遵循代码风格或引入安全问题的 PR 将被要求修改。

### 开发技巧

**添加新的数据层**

1. 在`src/services/`中创建服务用于获取数据
2. 在`src/components/Map.ts`中添加图层切换
3. 添加地图标记/叠加层的渲染逻辑
4.添加帮助面板文档
5. 使用层描述更新 README

**添加新的 API 代理**

1. 在`api/`目录中创建处理程序
2. 实现输入验证（参见现有代理）
3.添加适当的缓存头
4. 记录任何所需的环境变量

**调试**

- 浏览器开发工具 → API 问题的网络选项卡
- 控制台日志以 `[ServiceName]` 为前缀，以便于过滤
- 断路器状态在浏览器控制台中可见

---

## License

麻省理工学院

## Author

**埃利·哈比卜**

---

*专为态势感知和开源情报收集而构建。*
